/**
don't worry about lihting when opening the curtains at daytime
it can be a comedic moment
abi: Let's let some light in here.
(opens curtains)
abi: Huh. 
abi: practically no light is coming in.
paul: (sigh) even the sun hates me.
*/

//*********STATE**************//

enum stateType{
  eStateLightsOnDoorOpen = 0, 
  eStateLightsOffDoorOpen = 1, 
  eStateLightsOffDoorClosed = 2, 
  eStateLightsOnDoorClosed = 3
};
int currentState = eStateLightsOffDoorOpen;

function setState(int stateNum)
{
  currentState = stateNum;
  switch(stateNum)
  {
    case eStateLightsOnDoorOpen:
    Display("lightsondooropen");
      SetBackgroundFrame(0);
      oTypewriter.RemoveTint();
      oCurtains.RemoveTint();
      region[3].Tint(0, 0, 0, 0, 0);   
      region[4].Tint(0, 0, 0, 0, 0);
      
     // paulBedLight();
      
      hLamp.SetTextProperty("defaultVerb","turn off");
    hLamp.SetTextProperty("useVerb","turn off");
    
    hExit.SetTextProperty("moveVerb", "close");
    hExit.SetTextProperty("defaultVerb", "close");
    
    oDoorClosed.Visible = false;
    oPaulDoorOpen.Visible = true;
  
    RemoveWalkableArea(3);
    cNPCPaul.Loop = 0;
    oMatress.SetView(41, 1, 1);
    player.RemoveTint();
    break;
    case eStateLightsOffDoorOpen:
    Display("lightsoffdooropen");
    
      SetBackgroundFrame(1);            
      region[3].Tint(0, 10, 250, 60, 50);    
      region[4].Tint(0, 10, 250, 60, 50);    
      oTypewriter.Tint(0, 10, 250, 80, 50);
      oCurtains.Tint(0, 10, 250, 80, 50);
      //paulBedDark();
       hLamp.SetTextProperty("defaultVerb","turn on");
    hLamp.SetTextProperty("useVerb","turn on");
    
        hExit.SetTextProperty("moveVerb", "close");
    hExit.SetTextProperty("defaultVerb", "close");
    
    oDoorClosed.Visible = false;
    oPaulDoorOpen.Visible = true;
   
    RemoveWalkableArea(3);
    cNPCPaul.Loop = 1;
    oMatress.SetView(41, 1, 0);
    player.RemoveTint();
    break;
    
    
    
    case eStateLightsOffDoorClosed:
      Display("lightsoffDoorclosed");
      SetBackgroundFrame(2);
     // paulBedDark();
       hLamp.SetTextProperty("defaultVerb","turn on");
      hLamp.SetTextProperty("useVerb","turn on");
      
      region[3].Tint(0, 10, 250, 60, 50);    
      region[4].Tint(0, 10, 250, 60, 50);    
      oTypewriter.Tint(0, 10, 250, 80, 50);
      oCurtains.Tint(0, 10, 250, 80, 50);
      player.Tint(0, 10, 250, 80, 50);
      
      hExit.SetTextProperty("moveVerb", "open");
      hExit.SetTextProperty("defaultVerb", "open");
      oPaulDoorOpen.Visible = false;
      oDoorClosed.Visible = true;
      cNPCPaul.Loop = 2;
      oMatress.SetView(41, 1, 2);
    break;
    
    
    
    case eStateLightsOnDoorClosed:
      Display("lightsonDoorCLosed");
      SetBackgroundFrame(0);
    //  paulBedLight();
      
      oTypewriter.RemoveTint();
      oCurtains.RemoveTint();
      region[3].Tint(0, 0, 0, 0, 0);   
      region[4].Tint(0, 0, 0, 0, 0);
      
      hLamp.SetTextProperty("defaultVerb","turn off");
      hLamp.SetTextProperty("useVerb","turn off");
    
      hExit.SetTextProperty("moveVerb", "open");
      hExit.SetTextProperty("defaultVerb", "open");
      oPaulDoorOpen.Visible = false;
      oDoorClosed.Visible = true;
      cNPCPaul.Loop = 0;
      oMatress.SetView(41, 1, 1);
      player.RemoveTint();
    break;
  }
}

/*********************PAULS BEDROOM***************************************START UP*****************************************/

function moveOtherCharIntoPaulsRoomIfInDoorway()
{
  if(cOtherCharacter.Room == eRooms_FlatHallway)
  {
    if(Find.inRect(581, 187, 663, 222, true))
    {
      cOtherCharacter.ChangeRoom(eRooms_PaulsRoom);
    }
  }
}

function putOtherCharBackInKitchen()
{
  if(cOtherCharacter.Room == eRooms_FlatHallway)
  {
    if(cOtherCharacter.PreviousRoom == eRooms_FlatKitchen &&
    cOtherCharacter.y < 184)
    {
      cOtherCharacter.ChangeRoom(eRooms_FlatKitchen);
    }
  }
}

function putOtherCharBackInLounge()
{
  if(cOtherCharacter.Room == eRooms_FlatHallway)
  {
    if(cOtherCharacter.PreviousRoom == eRooms_FlatLounge &&
    cOtherCharacter.y < 184)
    {
      cOtherCharacter.ChangeRoom(eRooms_FlatLounge);
    }
  }
}

function setUpBed()
{
  
    //  oMatress.SetView(42, 2,0);
  
}

function setUpDoor()
{
  //if the door is open
  RemoveWalkableArea(3);
  
}

function room_Load()
{ 
  
  setUpDoor();
  changePlayerLocaleOnRoomEnter();
  resumeMusicAfterCHCH(aFlat_theme);
  if(Game.DoOnceOnly("setUpPaulsRoom")){
    oCurtains.SetView(39);
    paulBedDark();
  }
  if(cutScenes[4]<3){
    RemoveWalkableArea(2);
  }
 
    setState(currentState);
 
  
  Phone.adjustPhoneVolumeWhilstRinging();
  if(characterChange)
  {    
    Game.Camera.SetAt(400, 95);            
  } else {
    if(player.PreviousRoom == eCSR_paulCloseUp)
    {
      Game.Camera.SetAt(400, 95);   
      playMusic(aFlat_theme);
    } else {
      Game.Camera.SetAt(HandyHelper.recallCamX(), HandyHelper.recallCamY());
    }
  }
      
  moveOtherCharIntoPaulsRoomIfInDoorway();  
  putOtherCharBackInKitchen();
  putOtherCharBackInLounge();
  
  
  if(followed){
    cGhostl.ChangeRoom(eRooms_SpookyZone);   
  } else {
    seeGhost();
  }
  Follow.followStand(195, 147);
  Follow.followFrom(177,  106, 2);
  player.PlaceOnWalkableArea();
}

function room_AfterFadeIn()
{
  Follow.followMe(3); 
   if(characterChange)
  {
    flashPlayer();
    characterChange = false; 
  } else {
    if(player.PreviousRoom == eCSR_paulCloseUp)
    { 
      mouse.Mode = eModeWalkto;
    } else {
      Game.Camera.TweenPosition(1.0,  400,  95,  eEaseInOutSineTween, eNoBlockTween);   
    }
  }
  player.PlaceOnWalkableArea();
}
/******************************REGIONS*************************************REGIONS************************/


function region1_WalksOnto()
{
//  int remX = player.x + 400;
  //int remY = player.y + 95;
  HandyHelper.memorizeCamPos();
  Game.Camera.StopAllTweens();
  player.ChangeRoom(eRooms_FlatHallway, player.x, player.y);
}

function region2_Standing()
{
  player.z = 3;
}

function region2_WalksOff()
{
  player.z = 0;
}
function region4_WalksOff()
{
player.z = 0;
}
function region4_WalksOnto()
{
  player.z = 3;
}

/*******************************INTERACTION*******************************************INTERACTION****************************/

function pickupTypewriter()
{ 
  cPaul.Walk(677, 236, eBlock);
  cPaul.FaceDirection(eDirectionUpLeft, eBlock);
  cPaul.Say("Okay, I'll pick up the typewriter. Animate this eventually!");
  oTypewriter.Visible = false;
  cPaul.AddInventory(iTypewriter);   
}
function toggleLamp()
{
  if(!getOutOfTheWay(603, 233))
  {
    player.Walk(603, 233, eBlock, eWalkableAreas);
    
  }
  
  aClick1.Play(eAudioPriorityNormal);
  player.FaceDirection(eDirectionUpLeft, eBlock);
  
  switch(currentState)
  {
    case eStateLightsOffDoorOpen:
      setState(eStateLightsOnDoorOpen);
      
    break;
    case eStateLightsOffDoorClosed:
      setState(eStateLightsOnDoorClosed);
      
    break;
    case eStateLightsOnDoorOpen:
      setState(eStateLightsOffDoorOpen);
      
    break;
    case eStateLightsOnDoorClosed:
      setState(eStateLightsOffDoorClosed);
      
    break;
    
  }
      
}

function toggleCurtains()
{     
  if(oCurtains.Frame==0)
  {
    getOutOfTheWay(714, 260);
    
   // player.Walk(314, 165, eBlock);
    player.FaceDirection(eDirectionRight, eBlock);
    oCurtains.Animate(0, 0, eOnce, eNoBlock, eForwards);                
  } else {  
    getOutOfTheWay(690, 240);
    
  // player.Walk(290, 145, eBlock);
    player.FaceDirection(eDirectionRight, eBlock);
    oCurtains.Animate(0, 0, eOnce, eNoBlock, eBackwards);
  }
    oCurtains.toggleStatusOpenShut();
    oCurtains.toggleVerbOpenShut();  
}

/************************OBJECTS*******************************************OBJECTS*****************************************/

function takeTypewriter()
{
       if(IsPlayerAbi)
      {
        cAbi.Say("No way, I'm not stealing Paul's stuff.");
        if(cPaul.Room==eRooms_PaulsRoom)
        {
          cPaul.angry();          
          cPaul.Say("Thanks...");
          cPaul.cool();
        }
      } else {
        pickupTypewriter();               
      } 
}

function oTypewriter_AnyClick()
{
  switch (verbUsed)
  {
    case 0: //walk
      walkToAndFace(682, 236, eDirectionUp, 661, 239);          
    break;
    case 1://look
      player.FaceLocation(670, 225, eBlock);
      lookAbiPaul("It's Paul's typewriter.", 
                  "It's my typewriter.");
    break;
    case 2://use
      cPaul.angry();
      lookAbiPaul("Paul will have a hissy-fit if I touch his precious typewriter.",
                  "Nah I need some paper...And some ideas.");    
      cPaul.cool();
    break;
    case 3://talk
      Canned.noTalking();
    break;
    case 4://move
      lookAbiPaul("I'm not messing with Paul's typewriter,",
                  "If I'm going to lift it, I may as well take it with me.");
      if(!IsPlayerAbi)
      {
        pickupTypewriter();
      } else {
        player.Say("it's his prized possession.");
      }
    break;
    case 5://fourletters
      Canned.fuckAnyone();
    break;
    case 6://take
      takeTypewriter();
    break;
    case 7://inv
      Canned.wontWork();
    break;
  }
  verbUsed = 0;
}

function oCurtains_AnyClick()
{
switch (verbUsed)
{
  case 0: //walk
    if(oCurtains.Frame==0)
    {
      walkToAndFace(714, 260, eDirectionRight, 705, 247);           
    } else {
      walkToAndFace(690, 240, eDirectionRight, 705, 247);     
    }
  break;
  case 1://look
    player.FaceDirection(eDirectionRight, eBlock);
    lookAbiPaul("Whoever decorated this house was a fan of the EGA palette.", 
                "Classic curtains.");
  break;
  case 2://use
    Canned.noUsing();
  break;
  case 3://talk
    Canned.noTalking();
  break;
  case 4://move
    toggleCurtains();
  break;
  case 5://fourletters
    Canned.fuckAnyone();
  break;
  case 6://take
    Canned.cantTake();
  break;
  case 7://inv
    Canned.wontWork();
  break;
}
verbUsed = 0;

}


//************************HOTSPOTS***********************************************HOTSPOTS***********************************/

function hLamp_AnyClick()
{
  switch (verbUsed)
  {
    case 0: //walk
      walkToAndFace(603, 233, eDirectionLeft, 615, 234);
      
     // player.Walk(203, 138);
    break;
    case 1://look
      player.FaceLocation(188, 126, eBlock);
      lookAbiPaul("Pretty shabby lamp.", "This lamp cost me $10 on Trademe!");
    break;
    case 2://use
      toggleLamp();            
    break;
    case 3://talk
      Canned.noTalking();
    break;
    case 4://move
      Canned.noMoving();
    break;
    case 5://fourletters
      Canned.fuckAnyone();
    break;
    case 6://take
      cPaul.angry();
      lookAbiPaul("Nah I better not mess with Paul's lamp.","No way, the lamp stays!");  
      cPaul.cool();
    break;
    case 7://inv
      Canned.wontWork();
    break;
  }
  verbUsed = 0;
}

function hPaulsDesk_AnyClick()
{

switch (verbUsed)
{
  case 0: //walk
    player.Walk(276, 141);
  break;
  case 1://look
    lookAbiPaul("It's one of those plastic school desk from the 90's.", 
                "My cozy little writer's nook.");
  break;
  case 2://use
    Canned.noUsing();
  break;
  case 3://talk
    Canned.noTalking();
  break;
  case 4://move
    if(oTypewriter.Visible)
    {
      lookAbiPaul("If I open that desk the typewriter will topple over on the floor!",
                  "Not with the typewriter on it!");
    } else {
      lookAbiPaul("I'm not rummaging through Paul's private stuff...I might see something I'll wish I hadn't.",
                  "Maybe someday I will open that desk. Who knows what secrets are within.");
                  //note there should be some rad drawings to give to the tattooist//
    }    
  break;
  case 5://fourletters
    Canned.fuckAnyone();
  break;
  case 6://take
    Canned.cantTake();
  break;
  case 7://inv
    if(player.ActiveInventory == iTypewriter)
    {
      oTypewriter.Visible = true;
      player.LoseInventory(iTypewriter);
    } else {
      Canned.wontWork();
    }
  break;
}
verbUsed = 0;

}

function hPosterClown_AnyClick()
{
switch (verbUsed)
{
  case 0: //walk
    player.Walk(176, 134);
  break;
  case 1://look
  player.FaceLocation(166, 121);
    lookAbiPaul("Sam and the Santown Ghost Clowns.", "Sam and the Santown Ghosts.");
    if(IsPlayerAbi && cPaul.Room == eRooms_PaulsRoom)
    {
      cAbi.FaceCharacter(cPaul);
      cPaul.Say("Great band. Very colourful.");
    }
  break;
  case 2://use
    Canned.noUsing();
  break;
  case 3://talk
    Canned.noTalking();
  break;
  case 4://move
    Canned.noMoving();
  break;
  case 5://fourletters
    Canned.fuckAnyone();
  break;
  case 6://take
    Canned.cantTake();
  break;
  case 7://inv
    Canned.wontWork();
  break;
}
verbUsed = 0;
}

function hPosterButs_AnyClick()
{
switch (verbUsed)
{
  case 0: //walk
    player.Walk(176, 134);
  break;
  case 1://look
  
    player.FaceLocation(166, 121);
    lookAbiPaul("The Buts.", "The Buts.");
     if(IsPlayerAbi && cPaul.Room == eRooms_PaulsRoom)
    {
      cPaul.angry();
      
      cPaul.Say("Those guys are dicks,");
      cPaul.FaceCharacter(cAbi);
      cAbi.FaceCharacter(cPaul);
      cPaul.cool();
      cPaul.Say("But they're so good!");
      cAbi.Say("Sounds like a bunch of good dicks.");
    }
  break;
  case 2://use
    Canned.noUsing();
  break;
  case 3://talk
    Canned.noTalking();
  break;
  case 4://move
    Canned.noMoving();
  break;
  case 5://fourletters
    Canned.fuckAnyone();
  break;
  case 6://take
    Canned.cantTake();
  break;
  case 7://inv
    Canned.wontWork();
  break;
}
verbUsed = 0;
}

function hPosterFace_AnyClick()
{
switch (verbUsed)
{
  case 0: //walk
    player.Walk(306, 156);
  break;
  case 1://look
    player.FaceLocation(342, 160, eBlock);
    lookAbiPaul("David Bain and the Everystreets.", "David Bain and the Everystreets.");
     if(IsPlayerAbi && cPaul.Room == eRooms_PaulsRoom)
    {
      cPaul.Say("I know the bassist!");
      cAbi.FaceCharacter(cPaul);
      WaitMouseKey(25);
      cAbi.awkward();
      cAbi.Say("Cool...");
      cAbi.cool();
    }
  break;
  case 2://use
    Canned.noUsing();
  break;
  case 3://talk
    Canned.noTalking();
  break;
  case 4://move
    Canned.noMoving();
  break;
  case 5://fourletters
    Canned.fuckAnyone();
  break;
  case 6://take
    Canned.cantTake();
  break;
  case 7://inv
    Canned.wontWork();
  break;
}
verbUsed = 0;
}



function openCloseDoor()
{
  player.Walk(652, 232, eBlock, eWalkableAreas);
    player.FaceDirection(eDirectionUpLeft);
  switch(currentState)
  {
    case eStateLightsOffDoorOpen:
      setState(eStateLightsOffDoorClosed);
    break;
    case eStateLightsOnDoorOpen:
      setState(eStateLightsOnDoorClosed);
    break;     
    case eStateLightsOffDoorClosed:
      setState(eStateLightsOffDoorOpen);
    break;
    case eStateLightsOnDoorClosed:
      setState(eStateLightsOnDoorOpen);
    break;
  }
  
  
    
   /*
    player.Baseline = 300;
    //  player.TweenTint(0.4, 0, 10, 250, 60, 50, eEaseLinearTween, eNoBlockTween);
    oCloseAnimation.Visible = true;
    oPaulDoorOpen.Visible = false;
     SetBackgroundFrame(2);
    oCloseAnimation.SetView(42, 3, 0);
    oCloseAnimation.Animate(3, 3, eOnce, eBlock, eForwards);
   
    oCloseAnimation.Visible = false;
   
    RestoreWalkableArea(3);
    
    doorOpen = false;
    player.Baseline = 0;
    SetAmbientTint(0, 10, 250, 60, 50);
    
    hExit.SetTextProperty("moveVerb", "close");
    hExit.SetTextProperty("defaultVerb", "close");
    
    */
    
 
    /*  player.TweenTint(0.4, 0, 0, 0, 0, 0, eEaseLinearTween, eNoBlockTween);
      oCloseAnimation.Visible = true;
    
    oCloseAnimation.SetView(42, 3, 5);
    
    oCloseAnimation.Animate(3, 3, eOnce, eBlock, eBackwards, 5);
    SetBackgroundFrame(1);
    oCloseAnimation.Visible = false;
    
    
    player.Baseline = 0;
    SetAmbientTint(0, 0, 0, 0, 0);
    hExit.SetTextProperty("moveVerb", "open");
    hExit.SetTextProperty("defaultVerb", "open");
*/
  

}


function hExit_AnyClick()
{
switch (verbUsed)
{
  case 0: //walk
    player.GoTo(207, 105);
  break;
  case 1://look
    lookAbiPaul("That way back to the hall!", "I used to have a door...");
    if(!IsPlayerAbi){
      player.Say("After Campbell smashed up the Einstein door in the lounge,");
      cPaul.angry();
      player.Say("we replaced it with my door."); 
      player.Say("It's such bullshit!");
      cPaul.cool();
    }
  break;
  case 2://use
    Canned.noUsing();
  break;
  case 3://talk
    Canned.noTalking();
  break;
  case 4://move
    
    openCloseDoor();
  break;
  case 5://fourletters
    Canned.fuckAnyone();
  break;
  case 6://take
    Canned.cantTake();
  break;
  case 7://inv
    Canned.wontWork();
  break;
}
verbUsed = 0;

}

function room_Leave()
{
  HandyHelper.memorizeCamPos();
}

function region1_Standing(Region *theRegion)
{
  region1_WalksOnto();
}

function room_FirstLoad()
{
setUpBed();
}
