/*reflection stuff*/

// room script file

int startingPoint = 246;
int wall_x;

int getReflectLoop(Character* theChar)
{
   int l = theChar.Loop;    
      if(l==1){l=2;}
      else if(l==0){l=6;}  
      else if(l==2){l=1;}      
      else if(l==7){l=5;} 
      else if(l==4){l=6;} 
      else if(l==3){l=5;}
    return l;
}

int getReflectFrame(Character* theChar)
{
  return theChar.Frame;
}

int getReflectX(Character* theChar)
{
  return wall_x - (theChar.x-wall_x);
}

int getReflectY(Character* theChar)
{
  return theChar.y;
}

function areTheyTalking(Character* theChar, Character* reflection)
{
   if(theChar.Speaking)
    {
      reflection.ChangeView(theChar.SpeechView);
    } else {
      if(reflection.View != theChar.View)
      {
        reflection.ChangeView(theChar.View);
      }
    }
}

function moveMirrorDiag(Character* theChar)
{
  wall_x = startingPoint - theChar.y;
  //wall_x = 4 + FloatToInt((IntToFloat(theChar.x)/2.0)-1.0);
}


function reflectionTransparancy(Character* theChar, Character* reflection)
{ 
  if(theChar.x > 145)
  {reflection.Transparency = 100;}
  else
  {reflection.Transparency = 0;}
}

function moveReflection(Character* theChar,  Character* reflection)
{
   areTheyTalking(theChar, reflection);
 moveMirrorDiag(theChar);
  reflection.Loop = getReflectLoop(theChar);
  reflection.Frame = getReflectFrame(theChar);
  reflection.x = getReflectX(theChar);
  reflection.y = getReflectY(theChar);
 
  reflectionTransparancy(theChar, reflection);
}

function late_repeatedly_execute_always()
{
  moveReflection(player, cDummy);
}





function makeReflection()
{
cDummy.ChangeRoom(17);
cDummy.ChangeView(player.View);
cDummy.x=53;
cDummy.y=157;
cDummy.Tint(1, 2, 1, 50, 100);
cDummy.Baseline=1;
}


function room_Load()
{
  makeReflection();
  resumeMusicAfterCHCH(aEndlessOffice);
  changePlayerLocaleOnRoomEnter();
  player.PlaceOnWalkableArea();
  if(characterChange)
  {
     
  }
  Game.Camera.SetAt(8, 0);
}

function room_AfterFadeIn()
{
  if(!characterChange)
  {
    player.Walk(player.x, 143);
    characterChange = false;  
  }
  
}

function region1_WalksOnto()
{
  player.ChangeRoom(14, player.x + 216, player.y);
}

function hHotspot1_AnyClick()
{
  Display("Mirror x= %d, mirror y = %d",wall_x, cDummy.y);
}
