// room script file

int wasHere = 0;

int loadPos;

function setCameraPos()
{
  if(player.PreviousRoom == 1)
  {
    if(player.x < 333)
    {
      Game.Camera.SetSize(288, 160);      
      Game.Camera.X = 160;
      Game.Camera.Y = 26;    
      loadPos = 1;
    } else {
      loadPos = 2;
    }
    
  }
}

function roomChange(int room)
{
  switch(room)
  {
    case eRooms_FlatHallway:
      if(player.x < 333)
      {
        
         // Game.Camera.TweenSize(0.3, 288, 160, eEaseInOutSineTween, eNoBlockTween);
         // Game.Camera.TweenPosition(0.3, 160, 26, eEaseInOutSineTween, eBlockTween); 
          Game.Camera.TweenSize(0.3, 36, 20, eEaseInOutSineTween, eNoBlockTween);
          Game.Camera.TweenPosition(0.3, 236, 115, eEaseInOutSineTween, eBlockTween); 
        SetNextScreenTransition(eTransitionCrossfade);          
          player.ChangeRoom(eRooms_FlatHallway, player.x - 10, player.y + 127);
      } else {
    
      }
    break;
  }
}
/*
function setCameraPos()
{
  if(player.x < 349)
  {
    Game.Camera.X = 0;
  } else {
    Game.Camera.X = 300;
  }
}*/

function room_Load()
{   
  //panicReturn(137, 489);
  setCameraPos();
  changePlayerLocaleOnRoomEnter();
  Phone.adjustPhoneVolumeWhilstRinging();
  resumeMusicAfterCHCH(aOutside);
  
  if(characterChange){    
      
  } else {   
   
    if(player.PreviousRoom == eRooms_MapRoom)
    {
      beenToFlatHowManyTimes++;
     
      player.SetWalkSpeed(4, 3);
      gIconbar.Visible = true;
      gMapLabel.Visible = false;
      
      if(IsPlayerAbi){
      
      } else {
        paulJumper();
      }
      
    } else if (player.PreviousRoom == eRooms_FlatHallway)
    {
      
      playMusic(aOutside);
      
    }
  }
  player.PlaceOnWalkableArea();
  
}



/*
function region5_WalksOnto()
{
  SetNextScreenTransition(eTransitionInstant);
  Find.findScreenPosMap();
  player.ChangeRoom(eRooms_MapRoom, 420, 145);  
}
*/


function room_Leave()
{
  if(flyBuzz!=null)
  {
    if(flyBuzz.IsPlaying)
    {
      flyBuzz.Stop();
    }
  }
  if(dialTone!=null)
  {
    if(dialTone.IsPlaying)
    {
      dialTone.Stop();
    }
  }
  if(phoneRinging!=null)
  {
    if(phoneRinging.IsPlaying)
    {
      phoneRinging.Stop();
    }
  }
}

function tweenCamera(int position)
{
  wasHere = 0;
  if(position == 1)
  {
    player.Walk(player.x - 20, player.y);
    Game.Camera.TweenPosition(1.0, 0, 0, eEaseInOutSineTween, eNoBlockTween);
    if(Game.Camera.Width != 360)
    {
      Game.Camera.TweenSize(1.0, 360, 200, eEaseInOutSineTween);
    }
  } else {
    Game.Camera.TweenX(1.0, 300, eEaseInOutSineTween);
  }
}

function region1_WalksOff()
{
  wasHere = 1;
}

function region1_WalksOnto()
{
  if(wasHere == 2)
  {
    tweenCamera(1);
    
  }
}

function region2_WalksOff()
{
  wasHere = 2;
}

function region2_WalksOnto()
{
  if(wasHere == 1)
  {
    tweenCamera(2);
    
  }
}

function room_AfterFadeIn()
{
  if(loadPos == 1)
  {
    tweenCamera(1);
  }
}

function region3_WalksOnto()
{
  roomChange(eRooms_FlatHallway);
}
