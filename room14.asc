// Omni RIght Corridor

int hamishWalkBathroom = 0;
float waitToLeaveOffice = 1.0;
bool liftDoorsOpen = false;


/**********************************The Doors**************************************************/

//this function causing problems with restoring the walkable area in room_load
//added test to see if door is open, may create more issues?
function hamishBlockDoor(Object* theDoor, bool blockDoor)
{
  int walkArea = theDoor.GetProperty("walkArea");
  if(blockDoor)
  {    
    RemoveWalkableArea(walkArea);    
  } else {
    if(theDoor.GetProperty("isItOpen"))
    {            
      RestoreWalkableArea(walkArea);
    } else if(theDoor == oOCToilet1)
    {
      RestoreWalkableArea(walkArea);
    }
  }
}

/*
function makeDoorClickable(Object* theDoor, Hotspot* theHotSpot)
{
  if(!theDoor.Clickable)
  {
    theDoor.Clickable = true;
    theHotSpot.Enabled = true;
    RestoreWalkableArea(theDoor.GetProperty("walkArea"));
  }
}
function makeDoorUnClickable(Object* theDoor, Hotspot* theHotSpot)
{
  if(theDoor.Clickable)
  {
    theDoor.Clickable = false;
    theHotSpot.Enabled = false;
    RemoveWalkableArea(theDoor.GetProperty("walkArea"));
  } 
}
*/

bool exitingRoom = false;

function setUpLiftDoors()
{
  //seansean
  if(liftDoorsOpen)
  {
    oLiftDoor.SetView(47, 0, 16);
  } else {
    oLiftDoor.SetView(47, 0, 0);
  }
  RemoveWalkableArea(2);
  //disable lift interior hotspot
  oButtonLight.SetView(48, 0, 0);
  oButtonLight.Visible = false;
}

function setUpDoor(Object* theDoor, Hotspot* theHotspot)
{
  int view = theDoor.GetProperty("view");
  int maxFrame = theDoor.GetProperty("maxFrame");
  int walkArea = theDoor.GetProperty("walkArea");
  int doorNumber = theDoor.GetProperty("doorNumber");
  
  theDoor.Baseline = 155;
      
  if(theDoor.GetProperty("isItOpen"))
  {
    theDoor.SetView(view, 0, maxFrame);
    
  } else {
    theDoor.SetView(view, 0, 0);
    if(doorNumber != eDoorsOmniToilet)
    {          
      RemoveWalkableArea(walkArea);  
    } else {
      theHotspot.toggleOpenHotspot();
    } 
  }
}


function setUpDoors()
{
  setUpDoor(oOCToilet1, hToilet);
  setUpDoor(oLunchRoomDoor, hLunchRoom);
  setUpDoor(oITDoor, hITOffice);
  
  setUpLiftDoors();
}

function closeDoor(Object* theDoor, Hotspot* theHotspot, bool slow)
{
  int delay = 2;
  int walkArea = theDoor.GetProperty("walkArea");
  int doorNumber = theDoor.GetProperty("doorNumber");
  
  if(slow){ delay = 8; }
  else { aDoorCLose8bit.Play(eAudioPriorityHigh, eOnce); }    
    
  theDoor.Animate(0, delay, eOnce, eNoBlock, eBackwards);
  theDoor.SetProperty("isItOpen",false);
    
    if(doorNumber != eDoorsOmniToilet)
    {
      theDoor.SetTextProperty("moveVerb","open");
      theDoor.SetTextProperty("defaultVerb","open");
      RemoveWalkableArea(walkArea);
      theHotspot.toggleOpenHotspot();
    }      
}

function hamishCloseDoor(Object* theDoor, Hotspot* theHotspot, bool slow)
{
  int delay = 2;
  
  int doorNumber = theDoor.GetProperty("doorNumber");
  
  if(slow){ delay = 8; }
  else { aDoorCLose8bit.Play(eAudioPriorityHigh, eOnce); }    
    
  theDoor.Animate(0, delay, eOnce, eNoBlock, eBackwards);
  theDoor.SetProperty("isItOpen",false);
    
    if(doorNumber != eDoorsOmniToilet)
    {
      theDoor.SetTextProperty("moveVerb","open");
      theDoor.SetTextProperty("defaultVerb","open");      
      theHotspot.toggleOpenHotspot();
      //RestoreWalkableArea(5);  --no effect
    }      
}

function hamishOpenDoor(Object* theDoor, Hotspot* theHotspot)
{
  int doorNumber = theDoor.GetProperty("doorNumber");
  
  CharacterDirection direction = eDirectionUp;

  int XX = theDoor.GetProperty("XX");
  int YY = theDoor.GetProperty("YY");                      
  aDoorOpen1.Play(eAudioPriorityHigh, eOnce);
  theDoor.Animate(0, 1, eOnce, eNoBlock, eForwards);    
  theDoor.SetProperty("isItOpen", true);                       
}


function openDoor(Object* theDoor, Hotspot* theHotspot)
{
  int doorNumber = theDoor.GetProperty("doorNumber");
  int walkArea = theDoor.GetProperty("walkArea");
  CharacterDirection direction = eDirectionUp;
  int openView = theDoor.GetProperty("openViewPaul");
  if(IsPlayerAbi){ openView = theDoor.GetProperty("openViewAbi"); }
  int XX = theDoor.GetProperty("XX");
  int YY = theDoor.GetProperty("YY");
  
  if(!exitingRoom)
  {     
    player.StopMoving();
    
    //pushing door animation
    if(doorNumber!=eDoorsOmniToilet)
    {             
        player.LockView(openView, eStopMoving);
        player.Animate(0, 1, eOnce, eBlock, eForwards);      
    }
        
    aDoorOpen1.Play(eAudioPriorityHigh, eOnce);
    theDoor.Animate(0, 1, eOnce, eNoBlock, eForwards);
    if(doorNumber!=eDoorsOmniToilet)
    {           
      player.Animate(1, 1, eOnce, eBlock, eForwards);      
    }
    
    theDoor.SetProperty("isItOpen", true);
    
    if(doorNumber == eDoorsOmniToilet)
    {
        player.Walk(player.x, 144);      
    } else {
      player.UnlockView();
      
      player.Loop = direction;
      
      theDoor.SetTextProperty("moveVerb","close");
      theDoor.SetTextProperty("defaultVerb","close");            
      theHotspot.toggleOpenHotspot();
      RestoreWalkableArea(walkArea);
    }
  }
}
      
   /*   
function openOCToiletDoor()
{
 
  player.StopMoving();  
  //pushing door animation
      
  
  oOCToilet1.Animate(0, 1, eOnce, eNoBlock, eForwards);
  //WaitSeconds(0.2);
  player.Walk(player.x, 144);
      
  oOCToilet1.SetProperty("isItOpen",true);
 // OCToiletDoorIsOpen = true;
}
    */
    
bool NPCusingDoor = false;    
function autocloseDoor(Object* theDoor, Hotspot* theHotspot)
{
  if(!NPCusingDoor)
  {
    if(theDoor.GetProperty("isItOpen"))
    {
      if(player.distanceToObject(theDoor) > 50)
      {
        closeDoor(theDoor, theHotspot, true);
      }
    }  
  }
}

function autocloseDoors()
{
  autocloseDoor(oLunchRoomDoor, hLunchRoom);
  autocloseDoor(oITDoor, hITOffice);
  autocloseDoor(oOCToilet1, hToilet);
}

function region8_WalksOnto()
{
  openDoor(oOCToilet1, hToilet);  
}

function region8_WalksOff()
{
 // closeDoor(oOCToilet1, hToilet);

}

function chLockCounter(Object* theDoor, int toWhat)
{ //changes the counter in each door for the message when you try to open it while locked
  theDoor.SetProperty("lockCounter", toWhat);
}

function rattleHandle(Object* theDoor, int openView)
{
  int view;      
  if(IsPlayerAbi)
  { 
    view = theDoor.GetProperty("lockAbiView"); 
  }  else { 
    view = theDoor.GetProperty("lockPaulView"); 
  }
  
   player.LockView(view, eStopMoving);
   
   player.Animate(0, 1, eOnce, eBlock, eForwards);
   theDoor.Animate(0, 1, eOnce, eNoBlock);
   player.Animate(1, 1, eOnce, eBlock, eForwards);
   WaitSeconds(0.3);
   theDoor.Animate(0, 1, eOnce, eNoBlock);
   player.Animate(1, 1, eOnce, eBlock, eForwards);
   theDoor.Animate(0, 0, eOnce, eNoBlock);
   player.Animate(1, 0, eOnce, eBlock, eForwards);
   player.Animate(2, 1, eOnce, eBlock, eForwards);
   player.UnlockView();
   player.Loop = eDirectionUp;
   
}


function rattleHandleMore(Object* theDoor, int openView)
{   
  int view; 
  
  if(IsPlayerAbi)
  { 
    view = theDoor.GetProperty("lockAbiView"); 
  }  else { 
    view = theDoor.GetProperty("lockPaulView"); 
  }
  
   player.LockView(view, eStopMoving);
   
   player.Animate(0, 1, eOnce, eBlock, eForwards);
   theDoor.Animate(0, 0, eOnce, eNoBlock);
   player.Animate(1, 0, eOnce, eBlock, eForwards);
    theDoor.Animate(0, 0, eOnce, eNoBlock);
   player.Animate(1, 0, eOnce, eBlock, eForwards);
   theDoor.Animate(0, 0, eOnce, eNoBlock);
   player.Animate(1, 0, eOnce, eBlock, eForwards);
   theDoor.Animate(0, 3, eOnce, eNoBlock);
   player.Animate(1, 3, eOnce, eBlock, eForwards);
   theDoor.Animate(0, 0, eOnce, eNoBlock);
   player.Animate(1, 0, eOnce, eBlock, eForwards);
   theDoor.Animate(0, 0, eOnce, eNoBlock);
   player.Animate(1, 0, eOnce, eBlock, eForwards);
   player.Animate(2, 1, eOnce, eBlock, eForwards);
   player.UnlockView();
   player.Loop = eDirectionUp;
}


function lockDoor(Object* theDoor, bool lockThem)
{
  if(lockThem)
  {       
    theDoor.SetView(theDoor.GetProperty("lockedView"), 0, 0); //works, using a different view for locked door
    chLockCounter(theDoor, 0);   
    //theDoor.SetView(theDoor.GetProperty("view"), 1, 0);     //doesn't work, putting the locked door animation in a different loop in the same view.
  } else {
    theDoor.SetView(theDoor.GetProperty("view"), 0, 0);    
  }  
  theDoor.SetProperty("locked", lockThem);
}

function lockDoorsAfterHours(bool lockThem)
{
  lockDoor(oITDoor, lockThem);
  //lockDoor(oLunchRoomDoor, lockThem);  //don't know if locking LR is necessary
}

function isItOpeningHours()
{ 
  if(Time.isItBetweenTheseTimes(Employees_Omni.getArrival(true, cHamish), 
                                Employees_Omni.getArrival(false, cHamish), 
                                Employees_Omni.getDeparture(true, cHamish), 
                                Employees_Omni.getDeparture(false, cHamish)))                                
  {
    lockDoorsAfterHours(false);
  } else {
    lockDoorsAfterHours(true);
  }     
}
/*********************************Hamish***********************************************************/

//this function runs in rep execute
//triggered from another function which changed hwb to 1 to begin the process
//or it could set the initial condition within this switch.
//will need other exit/load conditions for if the player exits the room whilst
//this script is running

//problems: running past hamish. possible to disable quick walk while a script is running?
//leaving the room while script is running.
//go back to zero to test the conditions to choose a case to go to?
bool timerSet = false;

function hamishLoseMug()
{
  while(cHamish.HasInventory(iMug))
  {
    cHamish.LoseInventory(iMug);
  }
}

function hamishWalk()
{
  switch(hamishWalkBathroom)
  {
    case 0:
      if((!cHamish.HasInventory(iMug) && cHamish.HasInventory(iCoffeeBlack)) || 
         (!cHamish.HasInventory(iMug) && cHamish.HasInventory(iCakeSlice)))
      {
        if(cHamish.Room == eRooms_Omni_IT_Office) // IT Office
        {
          if(player.distanceToObject(oITDoor) > 40)
          {
            cHamish.ChangeView(105);
            
            hamishWalkBathroom = 1;
          }
        } 
      } 
      if(cHamish.HasInventory(iMug))
      {
        
        if(cHamish.Room == eRooms_Omni_Toilet)
        {
          if(!Hamish_Conditions.isTrappedInToilet()) 
          {
            
            if(!timerSet)
            {              
              SetTimerWithSeconds(6, 2.2);              
              timerSet = true;              
            }
            if(IsTimerExpired(6))
            {              
              hamishWalkBathroom = 20;
              timerSet = false;
            }
          }
        }
      }
    break;
    case 1:
      if(cHamish.delay(6.0))
      {            
        allowSkipWalk = false;
        hamishBlockDoor(oITDoor, true);
        cHamish.ChangeRoom(eRooms_Omni_CorridorRight, 662, 134, eDirectionDown);
        cHamish.Baseline = 0;
        cHamish.SetWalkSpeed(6, 6);    
        cHamish.AddWaypoint(627, 152);  
        timerSet = false;
        hamishWalkBathroom++;        
      }
    break;
    case 2:    
      if(cHamish.isAt(627, 152))
      {
        if(!oITDoor.GetProperty("isItOpen"))
        {
          hamishOpenDoor(oITDoor, hITOffice);        
        }
        hamishWalkBathroom++;
      } else {
        if(!cHamish.Moving)
        {
          cHamish.Walk(627, 152, eNoBlock, eWalkableAreas);  
        }
      }
    break;
    case 3:
      if(!oITDoor.Animating)  
      {
        cHamish.AddWaypoint(622, 169);
        hamishWalkBathroom++;
      }
    break;
    case 4:
      if(cHamish.y > 165)
      {
        hamishCloseDoor(oITDoor, hITOffice, true);
     //   makeDoorClickable(oITDoor, hITOffice);
        hamishWalkBathroom++;
      }
    break;
    case 5:
      cHamish.AddWaypoint(373, 176);
      cHamish.AddWaypoint(351, 162);      
      hamishWalkBathroom++;
    break;
    case 6:
      if(!oITDoor.Animating)
      {
        hamishBlockDoor(oITDoor, false);
        hamishBlockDoor(oOCToilet1, true);
        hamishWalkBathroom++;
      }
    break;
    case 7:
      if(cHamish.isAt(351, 162))
      {             
        hamishOpenDoor(oOCToilet1, hToilet);
        hamishWalkBathroom++;
      } else if (!cHamish.Moving)
      {
        cHamish.Walk(351, 162, eNoBlock, eWalkableAreas);
      }
    break;
    case 8:
      if(oOCToilet1.GetProperty("isItOpen"))
      {
        cHamish.AddWaypoint(385, 120);
        hamishWalkBathroom++;
      }
    break;
    case 9:
      if(cHamish.y < 153)
      {
        hamishCloseDoor(oOCToilet1, hToilet, false);
        hamishWalkBathroom++;
      }
    break;
    case 10:
      if(!oOCToilet1.GetProperty("isItOpen"))
      {
        if(cHamish.x > 376)
        {
        cHamish.ChangeRoom(eRooms_Omni_Toilet, 700, 700, eDirectionDown);
        hamishBlockDoor(oOCToilet1, false);        
        allowSkipWalk = true;
        hamishWalkBathroom = 0;
        }
      }
    break;
    
    case 20:    
      allowSkipWalk = false;
      hamishBlockDoor(oOCToilet1, true);
      cHamish.ChangeRoom(eRooms_Omni_CorridorRight, 349, 149 );
      hamishOpenDoor(oOCToilet1, hToilet);
      hamishWalkBathroom++;
    break;
    case 21:
      if(!oOCToilet1.Animating)
      {
        cHamish.AddWaypoint(357, 176);
        hamishWalkBathroom++;
      }
    break;
    case 22:
      if(cHamish.y > 170)
      {
        hamishCloseDoor(oOCToilet1, hToilet, false);
        hamishWalkBathroom++;
      }
    break;
    case 23:
      if(cHamish.isAt(357, 176))
      {
        hamishBlockDoor(oOCToilet1, false);
        cHamish.AddWaypoint(411, 176);
        hamishWalkBathroom++;
      } 
    break;
    case 24:
      if(cHamish.isAt(411, 176))
      {
        cHamish.FaceDirection(eDirectionUp);
        hamishWalkBathroom++;
      }
    break;
    case 25:
      if(cHamish.delay(2.5))
      {        
        cHamish.AddWaypoint(628, 169);
        hamishWalkBathroom++;
      }
    break;
    case 26:
      if(cHamish.isAt(628, 169))
      {
        hamishBlockDoor(oITDoor, true);
        cHamish.FaceDirection(eDirectionUp);
        if(!oITDoor.GetProperty("isItOpen"))
        {
          hamishOpenDoor(oITDoor, hITOffice);
        }
        hamishWalkBathroom++;
      }
    break;
    case 27:
      if(!oITDoor.Animating)
      {
        cHamish.AddWaypoint(658, 133);
        hamishWalkBathroom++;
      }
    break; 
    case 28:
      if(cHamish.y < 150)
      {
        hamishCloseDoor(oITDoor, hITOffice, true);
        hamishWalkBathroom++;
      }
    break;
    case 29: 
      if(cHamish.isAt(658, 133))
      {
        hamishLoseMug();
        cHamish.LoseInventory(iCoffeeBlack);
        cHamish.ChangeRoom(eRooms_Omni_IT_Office);
        cHamish.SCABS(0);
        hamishBlockDoor(oITDoor, false);
        allowSkipWalk = true;
        hamishWalkBathroom = 0;
      }
    break;
    
    case 40:
      cHamish.AddWaypoint(628, 169);
      hamishWalkBathroom = 26;
    break;
  }
}


/***************************Scrolling Stuff******************************************************************/

int wasHere = 0;
      

function region1_WalksOff()
{
  wasHere = 1;
}

function region1_WalksOnto()
{
  if(wasHere == 2)
  {
    Game.Camera.TweenX(1.0, 224, eEaseInOutSineTween, eNoBlockTween);
    wasHere = 0;
  }
}

function region2_WalksOff()
{
  wasHere = 2;
}

function region2_WalksOnto()
{
  if(wasHere == 1)
  {
    Game.Camera.TweenX(1.0, 478, eEaseInOutSineTween, eNoBlockTween);
    wasHere = 0;
  }
}

/***********************************Lift functions*****************************************************************/

bool liftDoorsOpening = false;
bool arrivingInLift;
bool someoneCalledLift = false;


int liftPos[20];
int peepsInLift = 0;

int waitPos[20];
int peepsWaiting = 0;

int waitTiming[20];

function initLiftPos()
{
  //0
  liftPos[0] = 732;
  liftPos[1] = 128;
  //1
  liftPos[2] = 781;
  liftPos[3] = 128;
  //2
  liftPos[4] = 749;
  liftPos[5] = 129;
  //3
  liftPos[6] = 722;
  liftPos[7] = 133;
  //4
  liftPos[8] = 729;
  liftPos[9] = 131;  
  //5
  liftPos[10] = 777;  
  liftPos[11] = 133;  
  //6
  liftPos[12] = 752;  
  liftPos[13] = 131;  
  //7
  liftPos[14] = 767;  
  liftPos[15] = 137;  
  //8
  liftPos[16] = 723;  
  liftPos[17] = 136;  
  //9
  liftPos[18] = 757;  
  liftPos[19] = 136;  
  
  //0
  
  waitPos[0] = 750;
  waitPos[1] = 149;
  //1
  waitPos[2] = 712;
  waitPos[3] = 154;
  //2
  waitPos[4] = 737;
  waitPos[5] = 165;
  //3
  waitPos[6] = 737;
  waitPos[7] = 164;
  //4
  waitPos[8] = 737;
  waitPos[9] = 165;
  //5
  waitPos[10] = 737;
  waitPos[11] = 165;
  //6
  waitPos[12] = 737;
  waitPos[13] = 165;
  //7
  waitPos[14] = 737;
  waitPos[15] = 165;
  //8
  waitPos[16] = 737;
  waitPos[17] = 165;
  //9
  waitPos[18] = 737;
  waitPos[19] = 165;
  
  
  waitTiming[0] = 0;
  waitTiming[1] = 40;
  waitTiming[2] = 80;
  waitTiming[3] = 120;
  waitTiming[4] = 160;
  waitTiming[5] = 200;
  waitTiming[6] = 240;
  waitTiming[7] = 280;
  waitTiming[8] = 320;
  waitTiming[9] = 360;  
}

bool setNumberInLine(Character* theChar)
{
  if(peepsWaiting < 10)
  {  
    
    theChar.SetProperty("numberInLine", peepsWaiting);
    peepsWaiting++;
    return true;
  } else {
    return false;
  }
}

bool setNumberInElevator(Character* theChar)
{
  if(peepsInLift < 10)
  {  
    
    theChar.SetProperty("numberInLine", peepsInLift);
    peepsInLift++;
    return true;
  } else {
    return false;
  }
}

int NumberinLine(this Character*)
{
  return this.GetProperty("numberInLine");
}

float getWaitingTime(this Character*)
{
  return IntToFloat(waitTiming[this.NumberinLine()]) / 40.0;
}

int getLiftX(this Character*)
{
  return liftPos[this.NumberinLine() * 2];
}

int getLiftY(this Character*)
{
  return liftPos[this.NumberinLine() * 2 + 1];
}

int getWaitX(this Character*)
{
  return waitPos[this.NumberinLine() * 2];
}

int getWaitY(this Character*)
{
  return waitPos[this.NumberinLine() * 2 + 1];
}

function resetLiftPeeps()
{
  peepsInLift = 0;
  peepsWaiting = 0;
}
/*
bool enterLift()
{
  if(peepsInLift < 9)  
  {
    peepsInLift++;
    return true;
  } else {
    return false;
  }
}



int liftX()
{
  int index = peepsInLift * 2;
  int result = liftPos[index];
 // Display("the x is %d", result);
  return result;
}

int liftY()
{
  int index = peepsInLift * 2 + 1;
  int result = liftPos[index]; 
  enterLift();
  return result;  
}

bool waitForLift()
{
  if(peepsWaiting < 9)
  {
    peepsWaiting++;
    return true;
  } else {
    return false;
  }
}

int waitX()
{
  int index = peepsWaiting * 2;
  int result = waitPos[index];
  return result;
}

int waitY()
{
  int index = peepsWaiting * 2 + 1;
  int result = waitPos[index];
  waitForLift();
  return result;
}
*/
function liftDoorSound()
{
  aElevatorDoor.Play(eAudioPriorityHigh, eOnce);
}

function npcCallLift(Character* theChar)
{  
  aLiftButton.Play(eAudioPriorityHigh, eOnce);
  someoneCalledLift = true;
  if(oLiftDoor.Frame == 0)
  {
    oButtonLight.Visible = true;
    oButtonLight.Animate(0, 10, eOnce, eNoBlock, eForwards);
  }
  SetTimerWithSeconds(15, 3.0);
}  


function callLift()
{
    player.Walk(750, 149, eBlock);
    player.FaceDirection(eDirectionUp, eBlock);
    aLiftButton.Play(eAudioPriorityHigh, eOnce);
    someoneCalledLift = true;
    setNumberInLine(cAbi);
    if(oLiftDoor.Frame == 0)
    {
      oButtonLight.Visible = true;
      oButtonLight.Animate(0, 10, eOnce, eNoBlock, eForwards);
    }
    
    //push the button animation
    
    SetTimerWithSeconds(15, 3.0);
}

function openLiftDoors()
{
  oButtonLight.Visible = false;
  liftDoorSound();
  oLiftDoor.Animate(0, 0, eOnce, eNoBlock, eForwards);  
  liftDoorsOpening = true;
}

function properlyOpenLiftDoors()
{ 
  //creates a delay on restoring the walkable lift area so that 
  //you can't walk through the doors while they're opening
  if(liftDoorsOpening)
  {
    if(oLiftDoor.Frame == 18)
    {
      liftDoorsOpening = false;
      liftDoorsOpen = true;
      SetTimerWithSeconds(15, 5.0);
     // liftDoorsOpen = true;
      RestoreWalkableArea(2);
    }
  }
}


function closeLiftDoors()
{
  someoneCalledLift = false;
  RemoveWalkableArea(2);
  if(arrivingInLift)
  {
    arrivingInLift = false;
  }
  liftDoorSound();
  oLiftDoor.Animate(0, 0, eOnce, eNoBlock, eBackwards);
  
  Wait(1);
  liftDoorsOpen = false;
  if(Find.inRect(737, 140, 747, 147))
  {
    player.Walk(player.x, player.y-10, eBlock, eAnywhere);
  }
  resetLiftPeeps();
}

function liftArrival()
{
  WaitSeconds(0.6);
  EndCutscene();
  openLiftDoors();
}

function waitingForLift()
{
  if(IsTimerExpired(15))
  {
    if(liftDoorsOpen)
    {
      closeLiftDoors();
    } else {
      openLiftDoors();
    }
  }
}

/*********NPC SCRIPTING SCABS*******************/

//need to work on this. should maybe be attached to door closing?
function npcChangeRoomToSpookyZone(Character* theChar)
{
  if(theChar.Room == eRooms_Omni_CorridorRight)
  {     
    if(theChar.InRect(712, 123, 796, 142) && !player.InRect(712, 123, 796, 142))
    {      
      if(oLiftDoor.Frame == 0)
      {      
      theChar.ChangeRoom(eRooms_SpookyZone);
      }
    }    
  }  
}

function charArrivalTriggers()
{
  if(Time.atTimeOfDay(Employees_Omni.getArrival(true, cJohn), 
                      Employees_Omni.getArrival(false, cJohn))) //john arriving
  {    
    cJohn.ChangeRoom(eRooms_Omni_CorridorRight, 752, 133);
    cJohn.ChangeView(cJohn.GetProperty("normalWalkView"));
    cJohn.SetProperty("strolling",true);
    cJohn.SCABS(100);                
  }   
  
  if(Time.atTimeOfDay(Employees_Omni.getArrival(true, cHamish), 
                      Employees_Omni.getArrival(false, cHamish)))
  {
    cHamish.ChangeRoom(eRooms_Omni_CorridorRight, 752, 133);
    cHamish.ChangeView(cHamish.GetProperty("normalWalkView"));
    cHamish.SetWalkSpeed(4, 4);    
    cHamish.SetProperty("strolling",true);
    cHamish.SCABS(100);  
  }
}

/*
function GoHome(Character* theChar)
{   
 // bool chosenWaitDest = false; //is this necessary? try removing it with block
  //don't like initialising variables in rep ex
  //although they will be disposed of every cycle, right?
    
  
  if(theChar.Room == eRooms_Omni_CorridorRight)
  {
    
  }
}*/

function charMove(Character* theChar)
{  
  if(theChar.Room == eRooms_Omni_CorridorRight)
  {
   
    switch(theChar.SCABS())
    {
      case 0:
         
      if(theChar.PreviousRoom == eRooms_Omni_CallCentre || theChar.PreviousRoom == eRooms_Omni_IT_Office) //john leaving
      {
        theChar.Transparency = 0;
        theChar.y = 173;
        theChar.SCABS(10);    
        
      } else if (theChar.PreviousRoom == eRooms_SpookyZone)
      {
        if(theChar.InRect(712, 124, 794, 135))
        {
          Display("send to case 99");
          theChar.SCABS(99);       
        } else if(theChar == cHamish)
        {
          theChar.SCABS(119);
        } else {
          theChar.SCABS(104);
        }
      }                  
      break;
      
      case 10:      
        if(!theChar.Moving)
        {      
          theChar.PlaceOnWalkableArea();
          theChar.Walk(720, 168, eNoBlock);      
        }
        if(theChar.x > 717)
        {
         // if(!chosenWaitDest)
         // {
            setNumberInLine(theChar);
           // chosenWaitDest = true;
            theChar.SCABS(1);  
          //}              
        }
      break;
      case 11:      
        theChar.Walk(theChar.getWaitX(), theChar.getWaitY(), eNoBlock);
        theChar.SCABS(1);
      break;
      case 12:
        if(theChar.isAt(theChar.getWaitX(), theChar.getWaitY()))
        {         
          theChar.FaceDirection(eDirectionUp);
          theChar.SCABS(1);        
        } else {
          if(!theChar.Moving)
          {
            theChar.Walk(theChar.getWaitX(), theChar.getWaitY(), eNoBlock);          
          }
        }
      break;
      case 13:
        if(theChar.Loop == eDirectionUp)
        {        
          //play push button animation.
          if(!someoneCalledLift)
          {                    
            npcCallLift(theChar);
          }
          theChar.SCABS(1);        
        }
      break;            
      case 14:      
        if(oLiftDoor.Frame > 16)
        { 
          theChar.SCABS(1);     
        }
      break;
      case 15:
        if(theChar.delay(theChar.getWaitingTime()))
        {      
          theChar.Walk(theChar.getLiftX(), theChar.getLiftY(), eNoBlock, eWalkableAreas);  
          theChar.SCABS(1);                  
        } 
      break;
      case 16:
        if(!theChar.Moving && !theChar.isAt(theChar.getLiftX(), theChar.getLiftY()))
        {
          theChar.Walk(theChar.getLiftX(), theChar.getLiftY(), eNoBlock, eWalkableAreas); 
        }
        if(oLiftDoor.Frame == 0)
        {
          npcChangeRoomToSpookyZone(theChar);
        }
      break;
      ///////////////////////////////////////////////////////// 
      
      case 50: //hamish leaving office
        cHamish.Transparency = 0;
        cHamish.Walk(630, 150, eNoBlock, eAnywhere);
        cHamish.SCABS(1);
      break;
      case 51:    
        if(cHamish.isAt(630, 150))
        {
          if(!oITDoor.GetProperty("isItOpen"))
          {
            hamishOpenDoor(oITDoor, hITOffice);
          }
          cHamish.SCABS(1);
        } else {
          if(!cHamish.Moving)
          {
            cHamish.Walk(630, 150, eNoBlock, eAnywhere);
          }
        }
      break;
      case 52: 
       /* if(!oITDoor.GetProperty("locked") && oITDoor.Frame == 0)
        {
          lockDoor(oITDoor, true);
        }*/
        if(oITDoor.Frame > 7)
        {
          cHamish.Walk(629, 174, eNoBlock, eAnywhere);
          
          cHamish.SCABS(1);
        }
      
      break;
      case 53:       
        if(cHamish.isAt(629, 174))
        { 
          if(oITDoor.GetProperty("isItOpen"))
          {
            closeDoor(oITDoor, hITOffice, false);
          }       
          cHamish.SCABS(1);
        } else {
          if(!cHamish.Moving)
          {
            cHamish.Walk(629, 174, eNoBlock, eAnywhere);
          }
        }
      break;
      case 54:
        if(!cHamish.Moving)
        {
          cHamish.Walk(700, 174);
        }
        if(!oITDoor.GetProperty("locked") && oITDoor.Frame == 0)
        {          
          lockDoor(oITDoor, true);
          cHamish.SCABS(0);
        }
      break;  
      case 69:
      
      break;
      case 99: //arrival at office             
        if (player.InRect(712, 124, 794, 135) || oLiftDoor.Frame > 0)  //changed and to or
        {
         // Display("whoops player in lift, doors open etc");
          theChar.ChangeRoom(eRooms_SpookyZone);
          theChar.SCABS(0); //reset, sorry player in the way, or in elevator
        } else {
          
          theChar.Transparency = 0;
          setNumberInLine(theChar);
          Display("number in line: %d, lift x: %d, lift y: %d", theChar.NumberinLine(), theChar.getLiftX(), theChar.getLiftY());
          theChar.x = theChar.getLiftX();        
          theChar.y = theChar.getLiftY();
          theChar.FaceDirection(eDirectionDown, eNoBlock);         
          theChar.SCABS(1);          
        }
      break;
      case 100:
        if(!theChar.NumberinLine())
        {
          if(theChar.delay(2.0)) //sean just added this
          {
            theChar.SCABS(1);
          }
        } else {
          theChar.SCABS(1);
        }
      break;
      case 101:    
        if(theChar.Loop==eDirectionDown)
        {
          if(!liftDoorsOpening)
          {
            openLiftDoors();
          }
          theChar.SCABS(1);
        }
      break;
      case 102:    
        if(oLiftDoor.Frame > 16)
        {
          if(theChar.delay(theChar.getWaitingTime()))
          {
            theChar.SCABS(1);
          }
        }
      break;
      case 103:          
        if(oLiftDoor.Frame > 14)
        {
          theChar.SCABSwalk(743, 144);
        }
      break;
      case 104:          
        if(theChar == cHamish)
        {
          theChar.SCABS(119);
        } else {
          if(theChar.Transparency != 0) //sean just added this, might break it whoops!
          {
            theChar.Transparency = 0;
          }
          theChar.SCABSwalk(264, 171);
        }
      break;
      case 105:    
        if(theChar.x < 266)
        {
          theChar.SCABS(0);
          theChar.ChangeRoom(eRooms_Omni_CallCentre, theChar.x + 707, theChar.y);         
        }
      break;
      /////////////////////////////////////////////////////////////////////
      case 119:
        if(theChar.Transparency != 0)
        {
          theChar.Transparency = 0;
        }
        theChar.SCABSwalk(704, 173);            
      break;    
      case 120:        
        theChar.SCABSwalk(629, 168);           
      break;    
      case 121:      
          lockDoor(oITDoor, false);
          NPCusingDoor = true;
          hamishOpenDoor(oITDoor, hITOffice);
          hamishBlockDoor(oITDoor, true);
          theChar.SCABS(1);      
      break;
      case 122:      
        cHamish.SCABSwalk(630, 140, 1, eAnywhere);
      break;  
      case 123:
        if(NPCusingDoor)
        {
          NPCusingDoor = false;
        }
        cHamish.SCABSwalk(659, 132, 1, eAnywhere);
      break;
      case 124:
        hamishBlockDoor(oITDoor, false);
        theChar.SCABS(0);
        theChar.ChangeRoom(eRooms_Omni_IT_Office);        
      break;   
      
      
      
      default:
        theChar.SCABS(0);
      break;
    }  
    
    switch(theChar.SCABS())
    {
      case 0:
        
      break;
      ////////////////////////////////////////////////////////////////////
      
    }
    
  }
}

/**********************************Setting Up*************************************************/



function findCameraPositionAfterCharacterSwitch()
{
  //characterChange = false;
  switch(Find.findPlayer())
  {
    case 1:
    Game.Camera.SetAt(224, 0);
    break;
    case 2:
    Game.Camera.SetAt(478, 0);
    break;
  }
}

function findCameraPosition()
{
  if(player.PreviousRoom == eRooms_Omni_CallCentre)
  {
    Game.Camera.SetAt(0, 0);
  } else if(player.PreviousRoom == eRooms_Omni_Lift)
  {
    Game.Camera.SetAt(478, 0);
    arrivingInLift = true;    
  } else if (player.PreviousRoom == eRooms_Omni_Toilet)
  {
    Game.Camera.SetAt(224, 0);
  } else if (player.PreviousRoom == eRooms_Omni_StaffRoom)
  {
    Game.Camera.SetAt(224 + 138, 0);
  } else if (player.PreviousRoom == eRooms_Omni_IT_Office)
  {
    Game.Camera.SetAt(478, 0);
  } else {
    findCameraPositionAfterCharacterSwitch();
  } 
}


function prevRoomLoadConditions()
{

  if(player.PreviousRoom == eRooms_Omni_Toilet)
  {
    exitingRoom = true;
    oOCToilet1.SetProperty("isItOpen",true);
    //OCToiletDoorIsOpen = true;    
  } 
}

function prevRoomAFConditions()
{
  
   if(player.PreviousRoom == eRooms_Omni_CallCentre)
  {
    Game.Camera.TweenX(1.0, 224, eEaseInOutSineTween, eNoBlockTween);
    player.Walk(716, player.y, eNoBlock);
  } else if (player.PreviousRoom == eRooms_Omni_Lift)
  {
    liftArrival();
  } else if (player.PreviousRoom == eRooms_Omni_Toilet)
  {
    Game.Camera.TweenX(0.2, 224, eEaseInOutSineTween, eNoBlockTween);
    
    player.Walk(player.x, 180);
    closeDoor(oOCToilet1, hToilet, false);
    //closeOCToiletDoor();
    WaitSeconds(1.0);
    exitingRoom = false;
    
  } else if (player.PreviousRoom == eRooms_Omni_StaffRoom)
  {
    Game.Camera.TweenX(1.5, 224, eEaseInOutCubicTween, eNoBlockTween);
    
    player.Walk(player.x, 180);
    closeDoor(oLunchRoomDoor, hLunchRoom, false);
    
    WaitSeconds(1.0);
    exitingRoom = false;
  } else if (player.PreviousRoom == eRooms_Omni_IT_Office)
  {   
    player.Walk(player.x, 180);
    closeDoor(oITDoor, hITOffice, false);
    
    WaitSeconds(1.0);
    exitingRoom = false;
  }    
}

function room_Load()
{
 
  initLiftPos(); 
  prevRoomLoadConditions();  
  changePlayerLocaleOnRoomEnter();
  resumeMusicAfterCHCH(aEndlessOffice);
  
  findCameraPosition();
  player.PlaceOnWalkableArea();
  setUpDoors();
  isItOpeningHours();
  if(characterChange)
  {    
    Employees_Omni.putCharsInPlace();
    characterChange = false;
  }
  
  if(Hamish_Conditions.hasEatenCake())
  {
    waitToLeaveOffice = 4.0;
  }
  
    hamishBlockDoor(oITDoor, false);
    hamishBlockDoor(oOCToilet1, false);
  if(cHamish.Room == eRooms_Omni_CorridorRight)
  { 
    allowSkipWalk = false;
    
    if((!Hamish_Conditions.isFinishedInToilet() && Hamish_Conditions.hasHadCoffee()) || 
       (!Hamish_Conditions.isFinishedInToilet() && Hamish_Conditions.hasEatenCake())
    {      
      cHamish.place(450, 174);    
      hamishWalkBathroom = 5;
      
    } else if(Hamish_Conditions.isFinishedInToilet())
    { 
      if(!Hamish_Conditions.isTrappedInToilet())
      {
        cHamish.place(559, 175);
        cHamish.FaceDirection(eDirectionRight);
        hamishWalkBathroom = 26;      
      }
    }
  }
}

function room_AfterFadeIn()
{
  if(cHamish.Room == eRooms_Omni_CorridorRight)
  {  
    if((!Hamish_Conditions.isFinishedInToilet() && Hamish_Conditions.hasHadCoffee()) || 
       (!Hamish_Conditions.isFinishedInToilet() && Hamish_Conditions.hasEatenCake()))
    {
      cHamish.Walk(400, 174);
    } else if(Hamish_Conditions.isFinishedInToilet())
    {
      cHamish.Walk(628, 169);
    }
  }
  prevRoomAFConditions();
  
}

/*********************************Change Rooms****************************************************************/

function hamishFinishInToilet()
{  
  if(Hamish_Conditions.hasHadCoffee())
  {
    //cHamish.LoseInventory(iCoffeeBlack);
    Hamish_Conditions.giveCoffee(false);
    Hamish_Conditions.setFinishedInToilet(true);
    
  } else if(Hamish_Conditions.hasEatenCake())
  {
    Hamish_Conditions.setFinishedInToilet(true);
  }
}


function region3_WalksOnto()
{
  hamishFinishInToilet();
  player.ChangeRoom(eRooms_Omni_CallCentre, player.x + 707, player.y);
}

function changeRoomToLift(Character* theChar)
{
  theChar.ChangeRoom(eRooms_Omni_Lift, theChar.x - 478, theChar.y + 40);
}

function npcChangeRoomToLift(Character* theChar)
{
  if(theChar.Room == eRooms_Omni_CorridorRight)
  {    
    if(theChar.InRect(712, 123, 796, 142))
    {    
      changeRoomToLift(theChar);
    }
  }  
}





function region4_Standing()
{ 
  if(!arrivingInLift)
  {
    if(oLiftDoor.Frame == 0)
    {
      WaitSeconds(0.6);
      hamishFinishInToilet();
      changeRoomToLift(player);
      //player.ChangeRoom(eRooms_Omni_Lift, player.x - 478, player.y + 40);
      npcChangeRoomToLift(cJohn);
      npcChangeRoomToLift(cHamish);
      npcChangeRoomToLift(cFred);
      npcChangeRoomToLift(cBob);
      npcChangeRoomToLift(cSally);
    /*  if(cJohn.isAt(737, 128))
      {
        cJohn.ChangeRoom(eRooms_Omni_Lift, cJohn.x - 478, cJohn.y + 40);
      }*/
    }
  }
}


function region5_WalksOnto()
{
 // player.ChangeRoom(17, player.x - 215, player.y);
}

function region5_Standing()
{
  if(hToilet.Enabled)
  {
  player.ChangeRoom(eRooms_Omni_Toilet, player.x - 216, player.y);
  }
}

function region6_WalksOnto()
{
  player.ChangeRoom(eRooms_Omni_StaffRoom, player.x - 224, player.y);
}

function region7_WalksOnto()
{
  if(hITOffice.Enabled)
  {
    player.ChangeRoom(eRooms_Omni_IT_Office, player.x - 478, player.y);
  }
}



/***********************************Interaction****************************************************************/
function hLiftCaller_AnyClick()
{

switch (verbUsed)
{
  case 0: //walk
    walkToAndFace(750,149, eDirectionUp, 740, 160); 
  break;
  case 1://look
    player.FaceLocation(763, 143, eBlock);
    lookAbiPaul("It's the button for the lift.", 
                "It's the elevator's call button.");
  break;
  case 2://use
    if(Find.inRect(706, 140, 784, 165))
    {
      callLift();
    } else {
      Canned.tooFar();
    }      
  break;
  case 3://talk
    Canned.noTalking();
  break;
  case 4://move (push)
    if(Find.inRect(706, 140, 784, 165))
    {
      callLift();
    } else {
      Canned.tooFar();
    }   
  break;
  case 5://fourletters
    Canned.fuckAnyone();
  break;
  case 6://take
    Canned.cantTake();
  break;
  case 7://inv
    Canned.wontWork();
  break;
}
verbUsed = 0;

}



function oLiftDoor_AnyClick()
{

switch (verbUsed)
{
  case 0: //walk
    walkToAndFace(742, 151, eDirectionUp, 732, 170); 
  break;
  case 1://look
    player.FaceLocation(744, 141, eBlock);
    lookAbiPaul("The lift doors", "The doors for the elevator.");
  break;
  case 2://use
    lookAbiPaul("There's a button for the lift over there.",
                "If only there were a button for calling the elevator?");
  break;
  case 3://talk
    Canned.noTalking();
  break;
  case 4://move
    lookAbiPaul("I'm not going to attempt to pry them open with my bare hands.",
                "I could try and pry them open...");
  break;
  case 5://fourletters
    Canned.fuckAnyone();
  break;
  case 6://take
    Canned.cantTake();
  break;
  case 7://inv
    Canned.wontWork();
  break;
}
verbUsed = 0;

}

function interactDoors(Object* theDoor, Hotspot* theHotspot)
{
  int openView = theDoor.GetProperty("openViewPaul");
  if(IsPlayerAbi){ openView = theDoor.GetProperty("openViewAbi");}
  int lockCounter = theDoor.GetProperty("lockCounter");
  
  if(cHamish.Room == eRooms_Omni_CorridorRight && cHamish.distanceToObject(theDoor) < 80  && player.distanceToObject(oOCToilet1) < 80)
  {
    // player.Say("Hamish, get out of the way!");
  } else  {
    int XX = theDoor.GetProperty("XX");
    int YY = theDoor.GetProperty("YY");
    int isItOpen = theDoor.GetProperty("isItOpen");
  switch (verbUsed)
  {
    case 0: //walk
      walkToAndFace(XX, YY, eDirectionUp, XX+20, YY+10); 
    break;
    case 1://look
      player.FaceLocation(XX, YY, eBlock);
      lookAbiPaul(theDoor.GetTextProperty("lookAbi"),
                  theDoor.GetTextProperty("lookPaul"));    
    break;
    case 2://use
     // walkToAndFace(350, 162, eDirectionUp, 371, 171); 
     Canned.moveDontUse();
    break;
    case 3://talk      
     lookAbiPaul(theDoor.GetTextProperty("saidAbi"),
                  theDoor.GetTextProperty("saidPaul"));
    break;
    case 4://move
      //walkToAndFace(350, 162, eDirectionUp, 371, 171);
      if(player.distanceToObject(theDoor) < 50)
      {
        StartCutscene(eSkipESCOnly);
        getOutOfTheWay(XX, YY);
        player.FaceDirection(eDirectionUp);
        if(isItOpen)
        {          
          closeDoor(theDoor, theHotspot, false);
        } else {
          if(theDoor.GetProperty("locked"))
          {
            rattleHandle(theDoor, openView);
            //shrug
            WaitSeconds(0.5);
            if(lockCounter ==0)
            {
              player.Say("It's locked!");
              chLockCounter(theDoor, lockCounter + 1);
            } else if(lockCounter==1) 
            {
              player.Say("Still locked...");
              chLockCounter(theDoor, lockCounter + 1);
            } else if (lockCounter==2) 
            {
              rattleHandleMore(theDoor, openView);
              player.Say("Yup... That's a locked door.");
              
                chLockCounter(theDoor, 0);   
            }
          } else {
            openDoor(theDoor, theHotspot);    
          }
        }
        EndCutscene();
      } else {
        Canned.tooFar();
      }
    break;
    case 5://fourletters
      Canned.fuckAnyone();
    break;
    case 6://take
      Canned.cantTake();
    break;
    case 7://inv
      Canned.wontWork();
    break;
  }
  verbUsed = 0;  
  } 
}


function oOmniToilet1_AnyClick()
{
  if(cHamish.Room == eRooms_Omni_CorridorRight && cHamish.distanceToObject(oOCToilet1) < 80 && player.distanceToObject(oOCToilet1) < 80)
  {
     player.Say("Hamish, get out of the way!");
  } else {
  switch (verbUsed)
  {
    case 0: //walk
      walkToAndFace(350, 162, eDirectionUp, 371, 171); 
    break;
    case 1://look
      player.FaceLocation(350, 157, eBlock);
      lookAbiPaul("Omnichron only has Unisex toilets.", "It's a unisex toilet.");
      if(cAbi.Room == eRooms_Omni_CorridorRight)
      {
        if(!IsPlayerAbi)
        {
          cAbi.FaceCharacter(cPaul);
        }
        cAbi.Say("Very progressive.");
      }
    break;
    case 2://use
      walkToAndFace(350, 162, eDirectionUp, 371, 171); 
     //Canned.moveDontUse();
    break;
    case 3://talk
      Canned.noTalking();
    break;
    case 4://move
      walkToAndFace(350, 162, eDirectionUp, 371, 171); 
      //openToiletDoor()
    break;
    case 5://fourletters
      lookAbiPaul("But I'm so close - I can still make it!",
                  "It'd be pretty cruel to the cleaners.");
    break;
    case 6://take
      Canned.cantTake();
    break;
    case 7://inv
      Canned.wontWork();
    break;
  }
  verbUsed = 0;
  }
}




    
function oLunchRoomDoor_AnyClick(){  interactDoors(oLunchRoomDoor, hLunchRoom); }

function oITDoor_AnyClick(){  interactDoors(oITDoor, hITOffice);  }


/******************************HOTSPOT********************************************/

function interactHotspot(Object* theDoor, Hotspot* theHotspot)
{
  if(cHamish.Room == eRooms_Omni_CorridorRight && cHamish.distanceToObject(theDoor) < 80 && player.distanceToObject(oOCToilet1) < 80)
  {
   // player.Say("Hamish, get out of the way!");
  } else {
    int XX = theDoor.GetProperty("XX");
    int YY = theDoor.GetProperty("YY");
    bool isItOpen = theDoor.GetProperty("isItOpen");
    
  switch (verbUsed)
  {
    case 0: //walk
      if(isItOpen)
      {
        player.Walk(XX, YY - 20);
      } else {
        getOutOfTheWay(XX, YY);
        player.FaceDirection(eDirectionUp);
      }   
    break;
    case 1://look
      player.FaceLocation(XX, YY-10, eBlock);
      if(theHotspot == hITOffice)
      {
        if(player.distanceToObject(oITDoor) < 40)
        {
          if(cHamish.Room == eRooms_Omni_IT_Office)
          {
            lookAbiPaul(theHotspot.GetTextProperty("lookAbi"), 
                        theHotspot.GetTextProperty("lookPaul"));
          } else {
            lookAbiPaul("Looks like Hamish is out of the office right now!",
                    "There's nobody in the Computer room.");
          }
        } else {
          lookAbiPaul("The IT Office.",
                      "The computer room.");
        }
      } else {
      lookAbiPaul(theHotspot.GetTextProperty("lookAbi"), 
                  theHotspot.GetTextProperty("lookPaul"));
      }
    break;
    case 2://use
      Canned.noUsing();
    break;
    case 3://talk
      player.FaceLocation(XX, YY, eBlock);
      lookAbiPaul(theHotspot.GetTextProperty("saidAbi"), 
                  theHotspot.GetTextProperty("saidPaul"));
    break;
    case 4://move
       if(player.distanceToObject(theDoor) < 50)
      {
        StartCutscene(eSkipESCOnly);
        getOutOfTheWay(XX, YY);
        player.FaceDirection(eDirectionUp);
        if(isItOpen)
        {        
          closeDoor(theDoor, theHotspot, false);
        } else {
          openDoor(theDoor, theHotspot);    
        }
        EndCutscene();
      } else {
        Canned.tooFar();
      }
    break;
    case 5://fourletters
      Canned.fuckAnyone();
    break;
    case 6://take
      Canned.cantTake();
    break;
    case 7://inv
      if(isItOpen)
      {
        Canned.wontWork();
      } else {
        lookAbiPaul("That won't break the glass.",
                    "I'm not smashing a window today.");
      }
    break;
  }
  verbUsed = 0;
  }
}

function hCallcentre_AnyClick()
{

switch (verbUsed)
{
  case 0: //walk

    player.Walk(220, 173);
  break;
  case 1://look
    player.FaceLocation(1, 1, eBlock);
    lookAbiPaul("The call centre is through that way.", 
                "The telephone office is in that long room.");
  break;
  case 2://use
    Canned.noUsing();
  break;
  case 3://talk
    player.FaceDirection(eDirectionLeft);
    lookAbiPaul("Hi everybody!",
                "Everyone ready to make some sales?");
                WaitSeconds(0.6);
                player.angry();
    lookAbiPaul("Assholes.",
                "...Or whatever it is we do here..."); 
                player.cool();
  break;
  case 4://move        
    Canned.noMoving();
  break;
  case 5://fourletters
    Canned.fuckAnyone();
  break;
  case 6://take
    Canned.cantTake();
  break;
  case 7://inv
    Canned.wontWork();
  break;
}
verbUsed = 0;

}

function hLunchRoom_AnyClick(){ interactHotspot(oLunchRoomDoor, hLunchRoom);  }
function hITOffice_AnyClick(){  interactHotspot(oITDoor, hITOffice);          }


function interactVendingMachine(Hotspot* theHotspot)
{  
  
  int XX = 406;
  int YY = 174;
  String part = theHotspot.Name;
  int pushX = 444; 
  int pushY = 167;
  CharacterDirection direction = eDirectionLeft;
  if(!IsPlayerAbi)
  {
    direction = eDirectionRight;
    pushX = 382;
    pushY = 167;
  }
  
  
switch (verbUsed)
{
 
  case 0: //walk
    walkToAndFace(XX, YY, eDirectionUp, 380, 180);    
  break;
  case 1://look
    StartCutscene(eSkipESCOnly);
    if(part == "machine")
    {
      player.FaceLocation(XX, YY - 5, eBlock); 
      lookAbiPaul("It's the vending machine", 
                "Cool! A drinks machine!");                
    } else if(part == "window")
    {
      player.Walk(XX, YY, eBlock);
      player.FaceLocation(XX, YY - 5, eBlock); 
      lookAbiPaul("Oh man, it's sold out of everything except Mello Yello!",
                  "So many options, mostly sold out.");
    } else if (part == "box")
    {
      player.Walk(XX, YY, eBlock);
      player.FaceLocation(XX, YY - 5, eBlock); 
      lookAbiPaul("Nothing in the receptacle zone",
                  "Damn, nothing for free today.");
    } else if (part == "pay")
    {
      player.FaceLocation(XX, YY - 5, eBlock); 
      lookAbiPaul("This is the bit you pay with.",
                  "The bit where your Eftpost card goes in.");
    }
    EndCutscene();
  break;
  case 2://use
    lookAbiPaul("I need to pay first.",
                "I think this is the kind where you pay first.");
  break;
  case 3://talk
    Canned.noTalking();
  break;
  case 4://move
    if(player.distanceToLocation(XX, YY) > 70)
    {
      Canned.tooFar();
    } else {
      StartCutscene(eSkipESCOnly);
      
      player.Walk(pushX, pushY, eBlock, eWalkableAreas);
      player.FaceDirection(direction);
      lookAbiPaul("I'm gonna need help if I'm going to push this thing over.",
                  "If Abi was here we could push this thing over, for sure!");
      if(Find.whichRoomIsOtherOne() == eRooms_Omni_CorridorRight)
      {
        otherPlayerSay("You're on you're own.",
                        "Nah, fuck that!");
      }
      EndCutscene();
    }
  break;
  case 5://fourletters
     if(part == "pay")
    {
      lookAbiPaul("Sure, shorting out the machine with my own urine might be satisfying...",
                  "Nah...");
      lookAbiPaul("But I run the risk of electrocuting my urinary tract.",
                  "I'd better not...");            
    } else {
      Canned.fuckAnyone();
    }
  break;
  case 6://take
    if(part == "box")
    {
      lookAbiPaul("There's nothing in there.",
                  "It's empty.");
    } else if (part == "window")
    {
      lookAbiPaul("A layer of bullet-proof glass protects these Mello Yello cans.",
                  "I wish I could reach right through this glass and just grab one.");
    } else {
      Canned.cantTake();
    }
      break;
  case 7://inv    
      if(player.ActiveInventory == iPaulsCard || player.ActiveInventory == iAbiCard)
      {
        lookAbiPaul("I guess I'll get a can of Mello Yello.","");
      //buy drink();
      } else {
        lookAbiPaul("I can't pay with that.",
                    "That's not considered legal tender around these parts.");
      }    
  break;
}
verbUsed = 0;

}

function hVendingMachine_AnyClick(){  interactVendingMachine(hVendingMachine);  }

function hVendingBox_AnyClick(){      interactVendingMachine(hVendingBox);      }

function hVendingPay_AnyClick(){      interactVendingMachine(hVendingPay);      }

function hVendingWindow_AnyClick(){   interactVendingMachine(hVendingWindow);   }


int returnCounter = 0;

function countToHamish()
{
  if(cHamish.HasInventory(iCoffeeBlack) || cHamish.HasInventory(iCakeSlice))
  {
    if(cHamish.Room == eRooms_Omni_Toilet)
    {    
      returnCounter++;
      if(returnCounter == 3)
      {
        returnCounter = 0;        
        hamishFinishInToilet();        
      }
    }
  }
}

function room_Leave()
{
  countToHamish();
  allowSkipWalk = true;
  
}

function hHotspot10_Look()
{//
//  Display("Coordinates: %d, %d.", liftX(), liftY());

//  RestoreWalkableArea(5);
}

function HamishLeave()
{
  if(cHamish.Room == eRooms_Omni_IT_Office)
  {
    if(Time.atTimeOfDay(Employees_Omni.getDeparture(true, cHamish), 
                        Employees_Omni.getDeparture(false, cHamish)))
    {   
      //lockDoor(oITDoor, false);    
      cHamish.ChangeRoom(14, 658, 132);
      cHamish.ChangeView(105);
      cHamish.SCABS(50);            
    }
  }
}

function room_RepExec()
{ 
  HamishLeave();
    
  charArrivalTriggers(); 
  charMove(cJohn);
  charMove(cHamish);
  charMove(cBob);
  charMove(cFred);
  charMove(cSally);
  
  properlyOpenLiftDoors();
  
  
  waitingForLift();

  if(!hamishWalkBathroom)
  {
    autocloseDoors();
  }
  hamishWalk();
  cJohn.moveInOtherRoom(eRooms_Omni_CallCentre, 330, 
        eRooms_Omni_CorridorLeft, 1000, eRooms_Omni_CorridorRight, 595, 171, 270, 171);
  cJohn.moveInOtherRoom(eRooms_Omni_CorridorLeft, 454, 
        eRooms_Omni_HR, 592, eRooms_Omni_CallCentre, 10, 10, 321, 171);
                           
  Employees_Omni.staffArrive();    
  Employees_Omni.staffDepart();
  Employees_Omni.MoveInCallCenterFromAway(cBob);
  Employees_Omni.MoveInCallCenterFromAway(cFred);
  Employees_Omni.MoveInCallCenterFromAway(cSally);
  
}

function room_FirstLoad()
{
 //  initLiftPos(); 
}
