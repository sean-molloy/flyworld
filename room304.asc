// room script file
int currentPhoneme = 0;
function raiseBrows()
{
  if(currentPhoneme == 1)
  {
    oJohnBrows.Animate(0, 5, eOnce, eNoBlock, eForwards);
    currentPhoneme = 0;
    
  }
}

function lowerBrows()
{
  if(currentPhoneme == 2)
  {
     oJohnBrows.Animate(0, 5, eOnce, eNoBlock, eBackwards);
     currentPhoneme = 0;
  }
}

function worry()
{
  if(currentPhoneme == 3)
  {
    oWorry.Animate(0, 0, eOnce, eNoBlock);
    currentPhoneme = 0;
  }
}



function lookDownJohn()
{
  oLookDown.SetView(8, 0, 0);
  oLookDown.Animate(0, 0, eOnce, eNoBlock, eForwards, 0);
}

function quickLook()
{
  oLookDown.SetView(9, 0, 0);
  oLookDown.Animate(0, 0, eOnce, eNoBlock, eForwards, 0);
}
function JMSay(String johnSays)
{
  cJohnsMouth.SayAtSync(260, 60, 100, johnSays);
  //cJohnsMouth.SayAt(260, 60, 100, johnSays);
 // cJohnsMouth.SaySync(johnSays);
}



function room_AfterFadeIn()
{
  
  //Speech.SkipStyle = eSkipTime;
  StartCutscene(eSkipESCOrRightButton);
  
  JMSay("&1 G'Day, Abigeil,");
  WaitSeconds(0.5);
  lookDownJohn();
  JMSay("&2 uh, now. Obviously,");
  
  JMSay("&3 there's some things we have to talk about.");
  quickLook();
  JMSay("&4 um.");
  WaitSeconds(0.4);
  
  
  JMSay("&5 So, there's been some new information from the prophesy about you,");
  lookDownJohn();
  JMSay("&6 and it turns out that um,");
  JMSay("&7 yeah... ");
  WaitSeconds(0.2);
  
  JMSay("&8 it doesn't want you here anymore! That prophecy!");
  EndCutscene();
  player.ChangeRoom(305);
}

function room_Load()
{
 // Speech.VoiceMode = eSpeechVoiceOnly;
 // SetGameOption(OPT_LIPSYNCTEXT, 1);
  oJohnBrows.SetView(10, 0, 0);
  oLookDown.SetView(8, 0, 0);
  cJohnsMouth.Baseline = 4;
  oJaw.Y = -4000;
  oWorry.SetView(11, 0, 0);
  gIconbar.Visible = false;
  //game.lipsync_speed = 12;
 // game.text_speed = 12;
  
}

function room_Leave()
{
//  SetGameOption(OPT_LIPSYNCTEXT, 0);
}

function moveJaw()
{
 
 
  if(
    cJohnsMouth.Frame == 6 ||
    cJohnsMouth.Frame == 7 ||
    cJohnsMouth.Frame == 8 ||
    cJohnsMouth.Frame == 9 
  )
  {    
    
    oJaw.Y = 204;
    
  } else if(cJohnsMouth.Frame == 11)
  {
      
      oJaw.Y = 206;
  } else {
    oJaw.Y = -4000;
 
  }
 
}
int counter = 0;

int dryEyes = 70;
function jonBlink()
{
  counter++;
  if(counter == dryEyes)
  {
    oBlink.Visible = true;
    
  } else if (counter == dryEyes + 8)
  {
    oBlink.Visible = false;
    dryEyes = 70 + Random(100);
    counter = 0;
  }
}

function getPhonemeStressNum()
{ 
  if(TotalLipSync.GetCurrentPhoneme()!= null)
  {
    String theString = TotalLipSync.GetCurrentPhoneme();
    if(theString.EndsWith("1"))
    {
      currentPhoneme = 1;
    } else if (theString.EndsWith("2"))
    {
      currentPhoneme = 2;
    } else if(theString.EndsWith("3"))
    {
      currentPhoneme = 3;
    } else {
      currentPhoneme = 0;
    }
  } else {
    currentPhoneme = 0;
  }
}


function late_repeatedly_execute_always()
{
  getPhonemeStressNum();
  moveJaw();
  jonBlink();
  raiseBrows();
  lowerBrows();
  worry();
}

function room_RepExec()
{
  
}
