// room script file

int blinkDuration  = 8;
int blinkCounter = 0;
bool blinkingAllowed = false;
int dryEyes = 40;
function llBlink()
{
  if(blinkingAllowed)
  {
    blinkCounter++;
    if(blinkCounter == dryEyes)
    {
      
      oLandBlink.Visible = true;
    } else if (blinkCounter == dryEyes + blinkDuration)
    {
      oLandBlink.Visible = false;
      dryEyes = 30 + Random(60);
      blinkCounter = 0;     
    }
  }
}


bool abiBlinkingAllowed = true;
int counter = 0;
int abiDryEyes = 50;
function abiBlink()
{
  if(abiBlinkingAllowed)
  {
  
  counter++;
  if(counter == abiDryEyes)
  {
    oAbiBlink.Visible = true;
    
  } else if (counter == abiDryEyes + 8)
  {
    oAbiBlink.Visible = false;
    abiDryEyes = 50 + Random(100);
    counter = 0;
  }
  }
}


function stopLandBlink()
{
  blinkingAllowed = false;
 oLandBlink.Visible = false;
}


function paulSpeak(String paulSaid)
{
   cUPaulSideShot.SayAtSync(120, 100, 120, paulSaid);  
}


function room_Load()
{
  oShock.SetView(229, 2, 0);
  oAngryABi.SetView(229, 3, 0);
  //cutSceneShot = 12;
  if(cutSceneShot ==10)
  {
  cLandLordSide.Loop = 0;
  } else {
    cLandLordSide.Loop = 1;
    oEyeSHut.Visible = false;
  }
}

function landLordTalk(String theString)
{    
  cLandLordSide.SayAtSync(200 , 20,80,  theString);
}


function abiSpeak(String abiSays)
{
   cAbiCSide.SayAtSync(45, 23, 140, abiSays);
}

function shock()
{
  oAbiBlink.Visible = false;
  abiBlinkingAllowed = false;
  oShock.Animate(2, 3, eOnce, eNoBlock, eForwards);
}

function angry()
{
  oAngryABi.Animate(3, 3, eOnce, eNoBlock, eForwards);
}
function shot25()
{

   landLordTalk("&7 Oh, righto.");
   
   oEyeSHut.Visible = false;
   Wait(1);

   cLandLordSide.LockView(224);
   cLandLordSide.Animate(0, 2, eOnce, eNoBlock, eForwards, 0);
   angry();
   abiSpeak("&41 What's this about?");
   cLandLordSide.UnlockView(eStopMoving);
   cLandLordSide.Loop = 1;
   landLordTalk("&8 Well uh,");
  
  cutSceneShot++;
   player.ChangeRoom(27);
}

function shot30()
{
  blinkingAllowed = true;
  oAbiWOrry.Visible = true;
   abiSpeak("&42 Not the yacht!");
   oAbiWOrry.Visible = false;
   cAbiCSide.Loop = 1;
   //oAbiLookDown.Visible = true;
   WaitSeconds(0.1);
   oLandBrow.Visible = true;
    abiSpeak("&43 How will you do all your human trafficking?");
    //oAbiLookDown.Visible = false;
    
    
    landLordTalk("&15 No, no,");
    oLandBrow.Visible = false;
    cAbiCSide.Loop = 0;
    cutSceneShot++;
    player.ChangeRoom(27);
    //oh no nt the yacht.. etc
}

function shot32()
{
  blinkingAllowed = true;
  shock();
  abiSpeak("&44 Last time we saw him he...");
  WaitSeconds(0.5);
  abiSpeak("&45 He...");
  stopLandBlink();
  cLandLordSide.LockView(224, eStopMoving);
  cLandLordSide.Animate(2, 2, eOnce, eNoBlock);
  paulSpeak("&23 He went through the weird door.");
  cLandLordSide.UnlockView(eStopMoving);
  cLandLordSide.Loop = 0;
  landLordTalk("&19 Ah yup, which one's the weird door?");
  cutSceneShot++;
  player.ChangeRoom(329);
}

function room_AfterFadeIn()
{
  if(cutSceneShot == 25)
  {
    shot25();
  } else if (cutSceneShot == 30)
  {
    shot30();
  } else if (cutSceneShot == 32)
  {
    shot32();
  } else if (cutSceneShot == 34)
  {
    EndCutscene();
  }
}


function late_repeatedly_execute_always()
{
  llBlink();
  abiBlink();
}