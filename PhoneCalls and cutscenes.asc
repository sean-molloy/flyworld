bool doorLocks[20];

static bool Locks::CheckLocks(int doorNumber)
{
  return doorLocks[doorNumber];
  
}

static void Locks::LockDoor(int doorNumber, bool lockItUp)
{
  doorLocks[doorNumber] = lockItUp;
}

static bool Locks::isOmniGateLocked()
{
  return doorLocks[14];
}

static void Locks::LockGate(bool lockIt)
{
  doorLocks[14] = lockIt;
}

function initLocks()
{
  doorLocks[0] = true; //front door flat
  doorLocks[4] = false;//backdoor flat
  doorLocks[14] = false;
}

function game_start()
{
  initLocks();
}

int cutScenes[5];
export cutScenes;

//the phone alert needs:
/*
 make the ringtone quieter when the pause menu is on
 make obj alert clickable and goes to the obj screen
  
  
  
*/


//phoneCalls in the flat.
float  howLongWillCallerWaitForPickUp;

function phoneWillRing(float waitHowManySeconds)
{
    
  SetTimerWithSeconds(7, waitHowManySeconds);
//starts the timer for the phone
}

static void Phone::PromptPhoneCall()
{ 
  //should run when entering the flat from the exterior area.
  //condition here to see if pauls mum has called yet. calling a cutscene?
  if(cutScenes[eCutScenePaulsMumCallToAbi] == 0) //havent had this call yet
  {
    //if(beenToFlatHowManyTimes >=2) //entered from the street twice//change this to 2 later
    if(RoomCounter.TimesEnteredRoom(7) > 1)
    {
      phoneWillRing(8.0); //how long for the phone to ring
      howLongWillCallerWaitForPickUp = 30.0;  //how long it will ring for
      flatPhoneCallSteps = ePhCallWaitingForCall;
    }  
  }

}

//global variable: flatPhoneCallSteps
/*
0=nothing happening
1=waiting for a call
2=phone is ringing
3=picked up
*/

int findMinVolume()
{
  int result;
  int maxVol = SlVolSound.Value;
  if(maxVol > 0)
  {
    result = FloatToInt(( IntToFloat(maxVol) ) * 0.3);
  } else {
    result = 0;
  }
  return result;
}

//Sean here is the phonecall one needs to be adjusted for volume change in gui.
//also use enum to get rid of all these magic numbers!!
static void Phone::waitingForPhoneCall()
{ //runs in global rep ex
  if(player.GetProperty("locale") == 1 && player.Room != 302) //checking we're in the flat but not looking at the phone
  {
    if(flatPhoneCallSteps == ePhCallWaitingForCall)
    {
      if(IsTimerExpired(7))
      {
        flatPhoneCallSteps = ePhCallPhoneIsRinging;
        //phone rings!
        displayAlert(eAlertPhoneCall);
        phoneRinging = aIn_room_ringing.Play(eAudioPriorityHigh, eRepeat);        
        SetTimerWithSeconds(7, howLongWillCallerWaitForPickUp);
        if(player.Room==1)
        {
          phoneRinging.SetRoomLocation(443, 200);
        } else {
          phoneRinging.Volume = findMinVolume();
        }
      }
    } else if (flatPhoneCallSteps == ePhCallPhoneIsRinging){
      //phone is ringing
      if(IsTimerExpired(7))
      {
        phoneRinging.Stop();
        hideAlert();
        flatPhoneCallSteps = ePhCallNothingHappening;           
      }      
    }
  }
}



static void Phone::adjustPhoneVolumeWhilstRinging()
{ //this one can go in onload for all flat rooms?
  if(flatPhoneCallSteps == 2)
  {
    if(phoneRinging != null)
    {
      if(phoneRinging.Volume > 0)
      {
        if(player.Room == 1)
        {
          phoneRinging.SetRoomLocation(443, 208);
          phoneRinging.TweenVolume(1.5, SlVolSound.Value);
        } else if(player.Room == 7)
        {
          phoneRinging.TweenFadeOut(2.0);
          //phoneRinging.Stop(); 
          gAlert.Visible = false;
          flatPhoneCallSteps = 0;
        } else {        
          phoneRinging.TweenVolume(1.0, findMinVolume());
         // phoneRinging.SetRoomLocation(0, 0);
          
        }
      } else {
      //sound volume is down. probably dont need this block
      }
    }
  }
}

function paulsMumCallAbi()
{
  player.Say("this is me picking up the phone");
  cDummy.Say("hello how are you today?");
}

static void Phone::pickupPhoneCall()
{
  phoneRinging.Stop();
  //include animatino for getting the phone here    
  flatPhoneCallSteps = 3;
  hideAlert();
  if(cutScenes[3]==0)
  {
    cutScenes[3] = 1;
    paulsMumCallAbi();
  }
  //else if for all other phonecall stuff here..
      //answer the phone!
  
}



//randomly generate phone numbers!

static String Phone::phoneNumberGenerate(String areaCode)
{  
  return String.Format("%s-%d%d%d%d", areaCode, Random(9), Random(9), Random(9), Random(9));
}


static void Phone::generateAllPhoneNumbers()
{
  PHpaulsMum = Phone.phoneNumberGenerate("630");
  PHcynthia = Phone.phoneNumberGenerate("520");
}

/*********************MUSIC STUFF********************************/

function playMusic(AudioClip*thisClip)
{
  SetGameOption(OPT_CROSSFADEMUSIC, 4);
  musicTrack = thisClip.Play(eAudioPriorityLow, eRepeat);
  
}



function fadeOutMusic(float timing)
{
    if(musicTrack!=null)
    {     
      musicTrack.TweenFadeOut(timing,  eEaseInOutSineTween);
    }
    
}

function resumeMusicAfterCHCH(AudioClip*thisClip)
{
  if(characterChange)
  {
    if(cPaul.GetProperty("locale") != cAbi.GetProperty("locale"))    
    {
      musicTrack = thisClip.Play(eAudioPriorityLow, eRepeat);
    }
  }
}

//int prevVolume;
int prevPhoneVol;
int prevCoffeeVol;
function pauseMusic()
{  
  float pauseSeconds = 0.2;
  if(musicTrack!=null)
  {
    prevVolume = musicTrack.Volume;
    if(musicTrack.Volume > 10)
    {
      musicTrack.TweenVolume(pauseSeconds, 10, eEaseInOutSineTween, eNoBlockTween);
    } else {
      musicTrack.TweenVolume(pauseSeconds, 0, eEaseInOutSineTween, eNoBlockTween);
    }
   
  }
  if(flatPhoneCallSteps == 2) 
  {
    prevPhoneVol = phoneRinging.Volume;
    if(phoneRinging.Volume > 10)
    {
      phoneRinging.TweenVolume(pauseSeconds, 10, eEaseInOutSineTween, eNoBlockTween);
    } else {
      phoneRinging.TweenVolume(pauseSeconds, 0, eEaseInOutSineTween, eNoBlockTween);
    }
    
  }
  if(flyBuzz!=null && player.Room == 1)
  {
 
    flyBuzz.TweenSpeed(0.1, 0, eEaseInOutSineTween, eNoBlockTween);
  }
  
  if(coffeeMachineAudioChannel != null)
  {
    prevCoffeeVol = coffeeMachineAudioChannel.Volume;
    coffeeMachineAudioChannel.TweenVolume(0.7, 5, eEaseOutSineTween, eNoBlockTween);
  }
}

function changeCoffeeVol(int input)
{
  prevCoffeeVol = input;
}

//need to think about volume change whilst ambient sounds are playing
function unpauseMusic()
{
  float pauseSeconds = 1.0;
  if(musicTrack != null)
  { 
   musicTrack.TweenVolume(pauseSeconds, prevVolume, eEaseInOutSineTween, eNoBlockTween);
  }
   if(flatPhoneCallSteps == 2)
  {
    if(phoneRinging.PlayingClip.ID == 19){
      phoneRinging.TweenVolume(pauseSeconds, prevPhoneVol, eEaseInOutSineTween, eNoBlockTween);
    }
   
  }
    if(flyBuzz!=null)
  {
    flyBuzz.TweenSpeed(0.1, 1000, eEaseInOutSineTween, eNoBlockTween);
  }
  
  if(coffeeMachineAudioChannel != null)
  {
    coffeeMachineAudioChannel.TweenVolume(0.7, prevCoffeeVol, eEaseOutSineTween, eNoBlockTween);
  }
}
/**********************SOUND STUFF****************************************/

function doorOpenSFX()
{
   aDoorOpen1.Play(eAudioPriorityHigh, eOnce);
}

function doorCloseSFX()
{ 
  aDoorCLose8bit.Play(eAudioPriorityHigh, eOnce);
}

/********************CUTSCENES***********************/



//Listening to Campbell's answer machine message 1st time.
static void Cutscenes::CampbellMessageHeard1()
{
  cutScenes[2] = 1;
  SetNextScreenTransition(eTransitionInstant); 
  player.ChangeRoom(1); //engine doesn't like to run functions in between rooms
}
static void Cutscenes::CampbellMessageHeard2()
{  
  Wait(20);
  player.Say("Ah shit, Campbell's fucking fucked off!");
  player.Say("What a shitty day!");
  player.FaceDirection(eDirectionDown);
  player.Say("First I lose my job, now I gotta find a new flatmate!");
  cutScenes[2] = 2;
  EndCutscene();
  
  addObjective("Get new flatmate for Campbell's room", player);  
  
}



static int Cutscenes::findCutSceneRoom(int theShot)
{
  int result = 0;
  
  if( theShot == 4 )
  {
    result = eCSR_paulDoorOpen;
  } else if ( theShot == 5 )
  {
    result = eCSR_abiDoorwayLowAngle;
  } else if ( theShot == 6 )
  {
    result = eCSR_footsteps;
  } else if ( theShot == 7 )
  {
    result = eCSR_plugPull;
  } else if ( theShot == 8 ||
              theShot == 10 )
  {
    result = eCSR_abiSneaks; 
  } else if ( theShot == 9 ||
              theShot == 11 ||
              theShot == 14 ||
              theShot == 16 ||
              theShot == 18 ||
              theShot == 24 ||
              theShot == 28 )
  {
    result = eCSR_paulCloseUp;
  } else if ( theShot == 12 ||
              theShot == 20 )
  {
    result = eCSR_hallEmpty;
  } else if ( theShot == 13 )
  {
    result = eCSR_toothBrushing;
  } else if ( theShot == 15 ||
              theShot == 17 ||
              theShot == 19 )
  {
    result = eCSR_abiDoorway;
  } else if ( theShot == 21 ||
              theShot == 23 ||
              theShot == 26 ||
              theShot == 29 ||
              theShot == 31 )
  {
    result = eCSR_landlordCloseup;
  } else if ( theShot == 22 ||
              theShot == 27 )
  {
    result = eCSR_abiReaction;
  } else if ( theShot ==  25 ||
              theShot ==  30 ||
              theShot ==  32 ||
              theShot ==  34 )
  {
    result = eCSR_hallSideShot;
  } else if ( theShot == 33 )
  {
    result = eCSR_zoomDoor;
  } else {
    result = player.Room;
  }    
  return result;
}



static void Cutscenes::nextCutSceneShot()
{
  cutSceneShot++;
  if(Cutscenes.findCutSceneRoom(cutSceneShot) == player.Room)
  {
    Display(String.Format("End of sequence. cutsceneshot == %d, player.room == %d", cutSceneShot, player.Room));
    QuitGame(0);
  } else {
    player.ChangeRoom(Cutscenes.findCutSceneRoom(cutSceneShot));
  }
}