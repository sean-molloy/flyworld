// room script file
int letsScroll = 0;
function room_Load()
{
  letsScroll = 0;
  changePlayerLocaleOnRoomEnter();
  player.place(1081, 632);
  Game.Camera.SetSize(216, 120);
  Game.Camera.SetAt(868, 538);
  //CityScroll.setAllowScroll(false);
}

function room_AfterFadeIn()
{
  Game.Camera.TweenPosition(1.0,  982, 498, eEaseInOutSineTween, eNoBlockTween);
  Game.Camera.TweenSize(1.0, 360, 200, eEaseInOutSineTween, eNoBlockTween);  
}

int prevReg;
function region1_WalksOnto()
{
  prevReg = 1;
  
  if(!letsScroll)
  {
    SetTimerWithSeconds(12, 1.3);    
    Game.Camera.StopAllTweens(ePauseTween);
    Game.Camera.TweenX(1.3, player.x - 180, eEaseInOutSineTween, eNoBlock);
  }
}

function getScrolling()
{
  if(IsTimerExpired(12))
  {
    if(letsScroll)
    {
      //letsScroll = 0; //changed recently
    } else {
      letsScroll = 1;
    }    
  }  
}

function region2_WalksOnto()
{
  if(prevReg == 1)
  {
    if(letsScroll)
    {
      //SetTimerWithSeconds(12, 1.3);
      letsScroll = 0;
      allowWalk = true;
      Game.Camera.StopAllTweens(ePauseTween);
      Game.Camera.TweenX(1.3, 982, eEaseInOutSineTween, eNoBlock);
      player.Walk(1173, player.y, eNoBlock);
    }
  }
  prevReg = 2;
}


function on_mouse_click (MouseButton button)
{
  
  if(button == eMouseLeft)
  {
    if(mouse.Mode == eModeWalkto)
    {
      if(letsScroll == 1)
      {
        CityScroll.stopDolly();
        CityScroll.Scroll();     
      } else if (letsScroll == 2)
      {        
        CityScroll.ScrollDiag();
      }
    }
  }
}



function late_repeatedly_execute_always()
{
  if(letsScroll)
  {
    CityScroll.dollyMove();
  }
}


function region3_WalksOnto()
{
  if(letsScroll == 1)
  {
    //SetTimerWithSeconds(12, 1.3);
    letsScroll = 0;
    allowWalk = true;
    Game.Camera.StopAllTweens(ePauseTween);
    Game.Camera.TweenX(0.8, 260, eEaseInOutSineTween, eNoBlock);
    player.Walk(464, 647, eNoBlock);    
    SetTimerWithSeconds(14, 0.8);
  }
  
}

function setDiagScrollOn()
{
  if(IsTimerExpired(14))
  {
    if(!letsScroll)
    {
      letsScroll = 2;         
    }
  }
}

function region3_WalksOff()
{
  prevReg = 3;
}

function region4_WalksOnto()
{
  if(prevReg == 3)
  {
    //if(!letsScroll)
   // {
      letsScroll = 1;
      SetTimerWithSeconds(12, 1.3);    
      Game.Camera.StopAllTweens(ePauseTween);
      Game.Camera.TweenX(1.3, player.x - 80, eEaseInOutSineTween, eNoBlock);
   // }
    
  } 
}

function room_RepExec()
{
  if(letsScroll)
  {
    CityScroll.switchScrollBackOn();  
  }
  setDiagScrollOn();
  getScrolling();
}

function region4_WalksOff()
{
  prevReg = 4;
}
