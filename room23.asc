// room script file
//int letsScroll = 0;
int rememberXForCharChange;
int rememberYForCharChange;
//minus 2520 from all x values:
function setUpDoors()
{
  oKonbiniDoor.SetView(177, 0, 0);
}

function prevRoomCond()
{
  if(characterChange)
  {    
    Game.Camera.SetAt(rememberXForCharChange, rememberYForCharChange);
    Game.Camera.SetSize(360, 200);
  } else {
    switch(player.PreviousRoom)
    {
      case eRooms_Omni_Lobby: //OmniLobby
        player.place(2046, 631);
        Game.Camera.SetSize(216, 120);
        Game.Camera.SetAt(1848, 538);
      break;
      case eRooms_Konbini: //Konbini
        player.place(3965, 636);      
        Game.Camera.SetSize(216, 120);
        Game.Camera.SetAt(1445, 555);
        oKonbiniDoor.SCABS(12);
        oKonbiniDoor.SetView(177, 0, 8);
      break;
      case 25:
        if(player.x < 773)
        {
          Game.Camera.SetSize(216, 120);
          Game.Camera.SetAt(5240, 620);
          player.place(2806, 679);
          letsScroll = eScrollHorizontal;
        } else {
          
          Game.Camera.SetSize(216, 120);
          Game.Camera.SetAt(3430, 720);
          player.place(3640, 789);
          letsScroll = eScrollHorizontal;
        }
      break;
      default:
        player.place(2046, 631);
        Game.Camera.SetSize(216, 120);
        Game.Camera.SetAt(1848, 538);
      break;
    }
  }
}

function prevRoomAF()
{
  if(characterChange)
  {
    characterChange = false;
  } else {
    switch(player.PreviousRoom)
    {
      case eRooms_Omni_Lobby:
        Game.Camera.TweenPosition(1.0,  1962, 500, eEaseInOutSineTween, eNoBlockTween);
        Game.Camera.TweenSize(1.0, 360, 200, eEaseInOutSineTween, eNoBlockTween);  
      break;
      case eRooms_Konbini:
        Game.Camera.TweenSize(0.7, 360, 200, eEaseInOutSineTween, eNoBlockTween, 0.1);
        Game.Camera.TweenPosition(0.7, 1240, 500, eEaseInOutSineTween, eBlockTween,  0.1);
        letsScroll = eScrollNone;
      break;
      case 25:
        if(player.x < 5711)
        {
          Game.Camera.TweenSize(1.5, 360, 200, eEaseInOutSineTween, eNoBlockTween);
          player.Walk(player.x - 50, player.y, eNoBlock);
          Game.Camera.TweenPosition(1.5, 2590, 500, eEaseInOutSineTween, eNoBlockTween);
        } else {
          Game.Camera.TweenSize(1.5, 360, 200, eEaseInOutSineTween, eNoBlockTween);

          player.Walk(player.x + 50, player.y, eNoBlock);
          Game.Camera.TweenPosition(1.5, 3575, 620, eEaseInOutSineTween, eNoBlockTween);
        }
      break;
      default:
        Game.Camera.TweenPosition(1.0,  1962, 500, eEaseInOutSineTween, eNoBlockTween);
        Game.Camera.TweenSize(1.0, 360, 200, eEaseInOutSineTween, eNoBlockTween);  
      break;
    }
  }
}


function room_Load()
{
  setUpDoors();
  letsScroll = 0;
  changePlayerLocaleOnRoomEnter();
  
  prevRoomCond();
  //CityScroll.setAllowScroll(false);
}

function room_AfterFadeIn()
{
  prevRoomAF();
}



int prevReg;

function region1_WalksOnto()
{
  prevReg = 1;
  
  if(!letsScroll)
  {
    SetTimerWithSeconds(12, 1.3);    
    Game.Camera.StopAllTweens(ePauseTween);
    Game.Camera.TweenX(1.3, player.x - 180, eEaseInOutSineTween, eNoBlock);
  }
}

function getScrolling()
{
  if(IsTimerExpired(12))
  {
    if(letsScroll)
    {
      //letsScroll = 0; //changed recently
    } else {
      letsScroll = 1;
    }    
  }  
}

function region2_WalksOnto()
{
  if(prevReg == 1)
  {
    if(letsScroll)
    {
      //SetTimerWithSeconds(12, 1.3);
      letsScroll = 0;
      allowWalk = true;
      Game.Camera.StopAllTweens(ePauseTween);
      Game.Camera.TweenX(1.3, 4482, eEaseInOutSineTween, eNoBlock);
      player.Walk(2153, player.y, eNoBlock);
    }
  }
  prevReg = 2;
}


function on_mouse_click (MouseButton button)
{
 // if(GetLocationType(mouse.x, mouse.y) == eLocationNothing)
 // {
    if(button == eMouseLeft)
    {
      if(mouse.Mode == eModeWalkto)
      {
        if(Region.GetAtScreenXY(mouse.x, mouse.y) == region[15])
        {
          if(player.Moving)
          {
            /*
            if(player.Loop == eDirectionDownLeft
            || player.Loop == eDirectionDownLeft
            || player.Loop == eDirectionUp
            || player.Loop == eDirectionUpLeft)
            {
              if(Game.Camera.X + mouse.x < player.x)
              {
                player.FaceLocation(Game.Camera.X + mouse.x, Game.Camera.Y + mouse.y);
                Game.Camera.StopTweenPosition(ePauseTween);
              }
            } else {
              if(Game.Camera.X + mouse.x > player.x)
              {
                player.FaceLocation(Game.Camera.X + mouse.x, Game.Camera.Y + mouse.y);
                Game.Camera.StopTweenPosition(ePauseTween);
              }
            }
            */
          } else {
            player.FaceLocation(Game.Camera.X + mouse.x, Game.Camera.Y + mouse.y);
          }
          //player.GoToStraight(Game.Camera.X + mouse.x, player.y);
          ClaimEvent();
        } else {
          if(letsScroll == eScrollHorizontal)
          {
            CityScroll.stopDolly();
            CityScroll.Scroll();     
          } else if (letsScroll == eScrollDiagNW)
          {        
            CityScroll.ScrollDiag();
          }
        }
      }
   // }
  }
  
  
}
//4368
function moveParallaxObject(Object* theObject, int xPosition, float distance)
{
  theObject.X = (Room.Width - FloatToInt(IntToFloat(Game.Camera.X) / distance)) - xPosition;
  
}

function moveParalaxBuildingTest()
{
  
  if(Game.Camera.Y > 400)
  {
    moveParallaxObject(oParalax1, 3800, 5.0); //add 3500?
    //oParalax1.X =  (Room.Width - FloatToInt(IntToFloat(Game.Camera.X) / 5.0)) - 1500;
  }
}



function late_repeatedly_execute_always()
{
  moveParalaxBuildingTest();
  if(letsScroll)
  {
    CityScroll.dollyMove();
  }
}


function region3_WalksOnto()
{
  if(prevReg == 4)  
  {        
    letsScroll = eScrollNone;
    allowWalk = true;
Game.Camera.StopAllTweens(ePauseTween);
  if(player.InRect(1361, 597, 1532, 695))
  {
    Game.Camera.TweenPosition(1.5, 1240, 500, eEaseInOutSineTween, eNoBlockTween);    
  } else if (player.InRect(1521, 750, 1621, 798))
  { 
    Game.Camera.TweenPosition(1.5,  1368,  628, eEaseInOutSineTween, eNoBlockTween);    
  } else if (player.InRect(1072, 635, 1116, 679))
  {        
    Game.Camera.TweenPosition(1.3, 928, 500,  eEaseInOutSineTween, eNoBlockTween);    
  } else if (player.InRect(3757, 778, 3791, 804))
  {
    
  }
    //Game.Camera.StopAllTweens(ePauseTween);    
    //Game.Camera.TweenPosition(0.8, player.x - 200, player.y - 170, eEaseInOutSineTween, eBlockTween);
    //player.Walk(3964, 647, eNoBlock);    
    
  }
  
}

function setDiagScrollOn()
{
  
}

function region3_WalksOff()
{
  prevReg = 3;
}

function region4_WalksOnto()
{
  if(prevReg == 3)
  { 
    if(player.InRect(1041, 631, 1092, 682))
    {
      letsScroll = eScrollHorizontal;
      SetTimerWithSeconds(12, 1.3);    
      Game.Camera.StopAllTweens(ePauseTween);   
      Game.Camera.TweenX(1.5, player.x - 180, eEaseInOutSineTween, eNoBlockTween);    
    } else if(player.InRect(1486, 650, 1540, 690))
    {
      letsScroll = eScrollHorizontal;
      SetTimerWithSeconds(12, 1.3);    
      Game.Camera.StopAllTweens(ePauseTween);   
      Game.Camera.TweenX(1.5, player.x - 80, eEaseInOutSineTween, eNoBlockTween);    
    } else if (player.InRect(3757, 778, 3791, 804))
    {
      letsScroll = eScrollHorizontal;
      Game.Camera.StopTweenPosition(ePauseTween);
      Game.Camera.TweenPosition(1.5, 3662, 698, eEaseInOutSineTween, eNoBlockTween);
    }
  } 
}

function dontShowIconsIfHigh()
{
  if(player.y < Game.Camera.Y + 70)
  {
    gIconbar.Visible = false;    
  } else {
    if(!gIconbar.Visible && !IsGamePaused())
    {
      gIconbar.Visible = true;
    }
  }
}

bool playerOnReg5 = false;

function konbiniDoorProcess()
{
  switch(oKonbiniDoor.SCABS())
  {
    case 0:
      
    break;
    case 10:
      oKonbiniDoor.Animate(0, 2, eOnce, eNoBlock, eForwards);
      oKonbiniDoor.SCABS(1);
    break;
    case 11:
      if(oKonbiniDoor.delay(3.0))
      {
        
        oKonbiniDoor.SCABS(1);
      }
    break;
    case 12:
      if(!playerOnReg5)
      {
        oKonbiniDoor.SCABS(1);
      }
    break;
    case 13:
    oKonbiniDoor.Animate(0, 2, eOnce, eNoBlock, eBackwards);
    oKonbiniDoor.SCABS(0);
    break;
  }
}


bool konbiniWalkable = false;
function allowWalkInKonbini()
{
  if(!konbiniWalkable && oKonbiniDoor.Frame > 7)
  {
    konbiniWalkable = true;
    RestoreWalkableArea(2);
  } else if (konbiniWalkable && oKonbiniDoor.Frame < 7)
  {
    konbiniWalkable = false;
    RemoveWalkableArea(2);
  }
}

function room_RepExec()
{
  allowWalkInKonbini();
  konbiniDoorProcess();
  
  dontShowIconsIfHigh();
  CityScroll.emergencyCenterPlayer();
  CityScroll.continueEdgeJump();
  if(letsScroll)
  {
    CityScroll.switchScrollBackOn();  
  }
  setDiagScrollOn();
  getScrolling();
  
}

function region4_WalksOff()
{
  prevReg = 4;
}

int roadRunCounter = 5;


function region5_WalksOnto()
{
  playerOnReg5 = true;
  if(player.Baseline ==1)
  {
    player.Baseline = -1;
  }
}

function region5_WalksOff()
{
  playerOnReg5 = false;
//oKonbiniDoor.Animate(0, 2, eOnce, eNoBlock, eBackwards);
}

function region5_Standing()
{
  if(player.Moving && oKonbiniDoor.Frame == 0)
  {
    oKonbiniDoor.SCABS(10);
  }
}


function transitionToKonbini()
{
  Game.Camera.TweenPosition(0.1, 1240, 500, eEaseInSineTween, eBlockTween);
  //Game.Camera.TweenSize(0.1, 216, 120, eEaseInSineTween, eBlockTween);
  //Game.Camera.TweenPosition(1.5, 415, 555, eEaseOutSineTween, eBlockTween);
  player.ChangeRoom(eRooms_Konbini, player.x - 3607 , player.y - 405);
  
}
function region6_WalksOnto()
{
  transitionToKonbini();
}

function hKonbiniDoor_AnyClick()
{
   switch (verbUsed)
  {
    case 0: //walk        
      if(oKonbiniDoor.Frame > 7)
      {
        player.GoTo(1470, 630);
      } else {
        walkToAndFace(1446, 639, eDirectionRight, 1442, 635);
      }
    break;
    case 1://look
      player.FaceLocation(1470, 630, eBlock);
      lookAbiPaul("It's the door to Family Mart.", 
                  "It's an automatic door for the corner shop.");
    break;
    case 2://use
      Canned.noUsing();
    break;
    case 3://talk
      Canned.noTalking();
    break;
    case 4://move
      Canned.noMoving();
    break;
    case 5://fourletters
      Canned.fuckAnyone();
    break;
    case 6://take
      Canned.cantTake();
    break;
    case 7://inv
      Canned.wontWork();
    break;
  }
  verbUsed = 0;

  

}

function region7_Standing()
{
  player.Baseline = 1;
}

function region7_WalksOff()
{
  //oKonbiniDoor.Baseline = 1;
}

function region8_WalksOnto()
{
  if(player.InRect(1972, 558, 2040, 660))
  {
    Game.Camera.TweenSize(0.4, 108, 60, eEaseInSineTween, eNoBlockTween);
    Game.Camera.TweenPosition(0.4, 1880, 538, eEaseInSineTween, eBlockTween);
    player.ChangeRoom(eRooms_Omni_Lobby, 729, 149);
  } else if (player.InRect(2732, 633, 2948, 725))
  {
    Game.Camera.TweenSize(0.4, 216, 120, eEaseInSineTween, eNoBlockTween);
    Game.Camera.TweenPosition(0.4, 2720, 600, eEaseInSineTween, eBlockTween);
    player.ChangeRoom(25);
  } else if (player.InRect(3510, 745, 3631, 823))
  {
    Game.Camera.TweenSize(0.4, 216, 120, eEaseInSineTween, eNoBlockTween);
    Game.Camera.TweenPosition(0.4, 3454, 737, eEaseInSineTween, eBlockTween);
    player.ChangeRoom(25);
  }
}

function hOmniENtrance_AnyClick()
{
  player.GoTo(2012, 631);
}

function region11_WalksOff()
{
  prevReg = 11;
}

function region10_WalksOff()
{
  prevReg = 10;
}


function region10_WalksOnto()
{
  if(prevReg == 11)
  {
    
    letsScroll = eScrollNone;
    Game.Camera.StopAllTweens(ePauseTween);
  if(player.InRect(1361, 597, 1532, 695))
  {
    Game.Camera.TweenPosition(1.5,  1240, 500, eEaseInOutSineTween, eNoBlockTween);    
  } else if (player.InRect(1521, 750, 1621, 798))
  { 
    Game.Camera.TweenPosition(1.5,  1368,  628, eEaseInOutSineTween, eNoBlockTween);    
  } else if (player.InRect(1072, 635, 1116, 679))
  {        
    Game.Camera.TweenPosition(1.3, 928, 500,  eEaseInOutSineTween, eNoBlockTween);    
  } else if (player.InRect(3757, 778, 3791, 804))
  {
    
  }
   // Game.Camera.StopAllTweens(ePauseTween);
   // Game.Camera.TweenPosition(0.8, player.x - 200, player.y - 170, eEaseInOutSineTween, eBlockTween);
  }
}



function region11_WalksOnto()
{
  if(prevReg == 10)
  {
    
    letsScroll = eScrollDiagNW;
    if(player.Loop == eDirectionDown || player.Loop == eDirectionDownLeft 
    || player.Loop == eDirectionDownRight ||player.Loop == eDirectionRight)
    {
      Game.Camera.TweenPosition(0.5, Game.Camera.X + 50, Game.Camera.Y + 50, eEaseInOutSineTween, eNoBlockTween);
    } else {
      Game.Camera.TweenPosition(0.5, Game.Camera.X - 50, Game.Camera.Y - 50, eEaseInOutSineTween, eNoBlockTween);
    }
  }
}

function region12_WalksOff()
{
  prevReg = 12;
}

function region13_WalksOff()
{
  prevReg = 13;
}

function region12_WalksOnto()
{
  if(prevReg == 13)
  {
    if(player.InRect(1381, 617, 1546, 702))
    {
      letsScroll = eScrollNone;
      Game.Camera.StopTweenPosition(ePauseTween);
      Game.Camera.TweenPosition(1.3, 1240, 500,  eEaseInOutSineTween, eNoBlockTween);    
    } else if (player.InRect(1180, 617, 1222, 669))
    {
      letsScroll = eScrollNone;
      Game.Camera.StopTweenPosition(ePauseTween);
      Game.Camera.TweenPosition(1.3, 928, 500,  eEaseInOutSineTween, eNoBlockTween);    
    }
  }
}
//got up to here minusing 2520 off the x values. continue when you get a chance!!
function region13_WalksOnto()
{
  if(prevReg == 12)
  {
    if(player.InRect(3985, 690, 4132, 800))
    {
      letsScroll = eScrollNone;
      Game.Camera.StopTweenPosition(ePauseTween);
      Game.Camera.TweenPosition(1.3, 3888,  628, eEaseInOutSineTween, eNoBlockTween);
      //the right block
      //konbini pos: 3760, 500
    } else if (player.InRect(3712, 603, 3947, 661))
    {
      letsScroll = eScrollNone;
      Game.Camera.StopTweenPosition(ePauseTween);
      Game.Camera.TweenPosition(1.3, 3668, 500, eEaseInOutSineTween, eNoBlockTween);
    }
    
    
  }
}

function room_Leave()
{
  rememberXForCharChange = Game.Camera.X;
  rememberYForCharChange = Game.Camera.Y;
}
