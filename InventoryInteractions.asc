// all Inventory Interactions


function replaceInvItem(InventoryItem* turnThis, InventoryItem* intoThis)
{
  int index;
  for (int i = 0; i < invCustom.ItemCount; i++) {
    if (invCustom.ItemAtIndex[i] == turnThis) index = i;
  }
  player.LoseInventory(turnThis);
  player.AddInventory(intoThis, index);
 }

function Print(const string whatToPrint)
{
  DisplayAtY(150, whatToPrint);
}

function setCan(InventoryItem *Item)
{
  String canName = Item.Name;
 // int loop = Item.GetProperty("drinkLoop");
  cSodaCan.Name = canName;
  
  //cSodaCan.LockView(243);
  //cSodaCan.Loop = loop;
}

function animateDrinkOne(InventoryItem *Item)
{
   player.FaceDirection(eDirectionRight, eBlock);
      //animate before health bar
      int theView = Item.GetProperty("drinkView");
      LockViews(theView, theView);
      player.Animate(0, 3, eOnce, eBlock, eForwards);
}

int counter = 0;
int flashCounter = 0;
int flashInterval = 10;

bool canInRoom = false;
function animateDrinkTwo(InventoryItem *Item)
{
  
  //flashCounter = 0;
  //counter = 0;
  //flashInterval = 10;
  canInRoom = true;
  player.Animate(1, 3, eOnce, eBlock);
  cSodaCan.Baseline = Room.Height;
  
  cSodaCan.Transparency = 0;
  cSodaCan.ChangeRoom(player.Room, player.x + 17, player.y - 25, Item.GetProperty("drinkLoop"));
  aLitter.Play(eAudioPriorityHigh, eOnce);
  cSodaCan.TweenPosition(0.2, cSodaCan.x + 10, player.y, eEaseOutBounceTween, eNoBlockTween);
  player.Animate(2, 3, eOnce, eBlock);
  player.UnlockView(eStopMoving);
  player.Loop = eDirectionRight;
  
      //animate after health bar
}

function keepContainer()
{
  player.Animate(player.Loop, 3, eOnce, eBlock, eBackwards);
  player.UnlockView(eStopMoving);
  player.Loop = eDirectionRight;
}



function disappearDrinkRepEx()
{
  if(cSodaCan.Room == player.Room)
  {
    if(cSodaCan.y == player.y)
    {
      if(canInRoom)
      {
        canInRoom = false;
        cSodaCan.Baseline = cSodaCan.y;
          cSodaCan.TweenTransparency(1.0, 100, eEaseOutBounceTween, eNoBlockTween, 2.0);
        
      }
    }
    
    
    
    /*
    if(cSodaCan.y == player.y)
    {
      canInRoom = true;
    }
    if(canInRoom)
    {
      counter++;
      if(counter == flashInterval)
      {
        if(cSodaCan.Transparency)
        {
          cSodaCan.Transparency = 0;
        } else {
          cSodaCan.Transparency = 100;
        }
        counter = 0;
        flashInterval-- ;
        if(flashInterval < 1)
        {
          
          counter = 0;
          cSodaCan.ChangeRoom(eRooms_SpookyZone);
          canInRoom = false;
        }
       
      }  
    }
    */
  }
}

///seperate eatfood and drink Drink!
///need to conditinoally display the health bar when adding health so if we want to say something
//instead it will do that.
function drink(this Character*, InventoryItem* drinkWhat, InventoryItem* replacedWith)
{
  int drinkPoints  = drinkWhat.GetProperty("waterContent");  
  int healthPoints = drinkWhat.GetProperty("healthStars");
  int sanityPoints = drinkWhat.GetProperty("comfortFood");
  int energyInDrink = drinkWhat.GetProperty("energy");
  int oldEnergy = this.GetProperty("energy");
  int newEnergyPoints = this.addEnergy(energyInDrink); 
  int prevBladder = this.GetProperty("bladder");
  int alcoholContent = drinkWhat.GetProperty("alcoholContent");
  int howDrunk = this.GetProperty("howDrunk");
  int drinkVolume = drinkWhat.GetProperty("drinkVolume");//how much is in the container, how many drinks does it have
  int oldDirection = player.Loop;
      setCan(drinkWhat);
  if(player.Room == eRooms_Omni_Toilet || player.Room == eRooms_FlatToilet)
  {
    player.FaceDirection(eDirectionDown, eBlock);
    player.angry();
    lookAbiPaul("Gross, I'm not drinking in the toilet!", "That's unhygienic!");
    player.cool();
    player.FaceDirection(oldDirection, eBlock);
  } else {
    if(drinkPoints + prevBladder  > 30)
    {
      if(prevBladder < 30)
      {    
       
      animateDrinkOne(drinkWhat);
      
        this.SetProperty("bladder",30);
        if(energyInDrink)
        {
          this.addHealth(healthPoints, false);
        } else {
          this.addHealth(healthPoints);
        }
        this.addSanity(sanityPoints);
        if(drinkVolume <=1)
        {
          if(replacedWith)
          {
            replaceInvItem(drinkWhat, replacedWith);            
            player.ActiveInventory = replacedWith;
            keepContainer();
          } else {
            player.LoseInventory(drinkWhat);      
            animateDrinkTwo(drinkWhat);
          }  
        } else {
          drinkVolume--;
        }
      
        if(energyInDrink > 0)
        {
          if(oldEnergy < 72 && newEnergyPoints == 72)
          {
           // Canned.backGroundSayBoth("I'm totally wired!", "I'm pretty wide awake now!",2.0);
            lookAbiPaul("I'm totally wired!", "I'm pretty wide awake now!");
          }
        }
        if(alcoholContent > 0)
        {
          if(howDrunk < 15)
          {
            howDrunk++;
            this.SetProperty("howDrunk", howDrunk);
            if(howDrunk < 4)
            {
              player.Say("tipsy");
            } else if(howDrunk < 8)
            {
              player.Say("drunk");
            } else if (howDrunk < 12)
            {
              player.Say("very drunk");
              this.addHealth(-5);
            } else {
              player.Say("too drunk");
              this.addHealth(-5);
            }
          } else {
            this.addHealth(-50);
            player.Say("passing out");
          }
        } else if (alcoholContent < 0)
        {
          if(howDrunk > 1)
          {
            howDrunk--;
            this.SetProperty("howDrunk", howDrunk);
          }
        }
        
        
      } else {    
      lookAbiPaul("I can't drink anymore.",
                  "I'm completely full of fluid, and I cannot drink another drop.");                
      } 
    } else {  
      animateDrinkOne(drinkWhat); 
     
      if(drinkVolume > 1)
      {
        drinkVolume--;    
      } else {  
        if(replacedWith)
        {
          replaceInvItem(drinkWhat, replacedWith);
          player.ActiveInventory = replacedWith;
          keepContainer();
        } else {
          player.LoseInventory(drinkWhat);      
          animateDrinkTwo(drinkWhat);
        }  
      }
      
      this.SetProperty("bladder",this.GetProperty("bladder") + drinkPoints);    
      if(energyInDrink)
      {
        this.addHealth(healthPoints, false);
      } else {
        this.addHealth(healthPoints);
      }
      this.addSanity(sanityPoints);
      if(energyInDrink > 0)
      {
        if(oldEnergy < 72 && newEnergyPoints == 72)
        {
          lookAbiPaul("I'm totally wired!", "I'm pretty wide awake now!");
          //Canned.backGroundSayBoth("I'm totally wired!", "I'm pretty wide awake now!", 2.0);
        }
      }
      if(alcoholContent > 0)
      {
        if(howDrunk < 15)
        {
          howDrunk++;
          this.SetProperty("howDrunk", howDrunk);
          if(howDrunk < 4)
          {
            player.Say("tipsy");
          } else if(howDrunk < 8)
          {
            player.Say("drunk");
          } else if (howDrunk < 12)
          {
            player.Say("very drunk");
            this.addHealth(-5);
          } else {
            player.Say("too drunk");
            this.addHealth(-5);
          }
        } else {
          player.Say("passing out");
          this.addHealth(-50);
        }
      } else if (alcoholContent < 0)
      {
        if(howDrunk > 1)
        {
          howDrunk--;
          this.SetProperty("howDrunk", howDrunk);
        }
      }
      
    }
    drinkWhat.SetProperty("drinkVolume", drinkVolume);  
  }
}

function eatFood(this Character*, InventoryItem* eatWhat, InventoryItem* replacedWith)
{
  
  int foodPoints   = eatWhat.GetProperty("Protein");
  int healthPoints = eatWhat.GetProperty("healthStars");
  int sanityPoints = eatWhat.GetProperty("comfortFood");
  int energyInFood = eatWhat.GetProperty("energy");
  int newEnergyPoints; 
  
  if (foodPoints + this.GetProperty("stomach") > 30)
  {
    if(this.GetProperty("stomach")<30)
    {
      this.SetProperty("stomach",30);
      this.addHealth(healthPoints);
      this.addSanity(sanityPoints); 
      this.addEnergy(energyInFood);    
      if(replacedWith)
      {
        replaceInvItem(eatWhat, replacedWith);
      } else {
        player.LoseInventory(eatWhat);        
      }
    } else {        
    lookAbiPaul("I'm full!","I'm so full of food!");
    }
  } else {
  
    if(replacedWith)
    {
      replaceInvItem(eatWhat, replacedWith);
    } else {
      player.LoseInventory(eatWhat);      
    }            
    this.SetProperty("stomach", this.GetProperty("stomach")+ foodPoints);
    this.addHealth(healthPoints);
    this.addSanity(sanityPoints);
    this.addEnergy(energyInFood);    
  }
}

function lookEftposCards(InventoryItem *theCard)
{
  String lookCard;
  if(theCard == iAbiCard)
  {
    if(IsPlayerAbi)
    {
        lookCard = String.Format("It's my eftpos card. I have $%.2f.", AbiMoney);
    } else {
        lookCard = String.Format("It's Abi's eftpos card. She has $%.2f.", AbiMoney);
    }
  } else {
    if(IsPlayerAbi)
    {
      lookCard = String.Format("It's Paul's eftpos card. He has $%.2f.", PaulMoney);
    } else {
      lookCard = String.Format("It's my eftpos card. I have $%.2f.", PaulMoney);
    }
  }
    Print(lookCard);
}









int countToiletPaper()
{
  return player.InventoryQuantity[iToiletPaper.ID];
}

static void Inventory::resetToiletPaperPic()
{
  iToiletPaper.Graphic = 2264;
}

static void Inventory::setToiletPaperPic()
{
  
  int sprite;
  switch (countToiletPaper())
  {
    case 1:
      sprite = 2264;
    break;
    case 2:
      sprite = 2265;
    break;
    case 3:
      sprite = 2266;
    break;
    default:
      sprite = 2267;
    break;
    
  }
 
  iToiletPaper.Graphic = sprite;  
}



static void Inventory::reduceCaskWine()
{
  int amountInCask = iWineCask.GetProperty("drinkVolume");
  if(amountInCask > 1)
  {
    iWineCask.SetProperty("drinkVolume", amountInCask - 1);
  } else {
    replaceInvItem(iWineCask, iGoonBag);
    player.ActiveInventory = iGoonBag;
  }
}



String howFullWine()
{
  int howFull = iWineCask.GetProperty("drinkVolume");
  String result;
  if(howFull == 12)
  {
    result = "It's full!";
  } else if (howFull > 8)
  {
    result  = "It's three quarters full.";
  } else if (howFull > 7)
  {
    result = "It's two thirds full.";
  } else if (howFull > 5)
  {
    result  = "It's half full.";
  } else if (howFull > 3)
  {
    result = "There's a third left.";
  } else if (howFull > 2)
  {
    result = "There's a quarter left.";
  } else {
    result = "It's Nearly all gone!";
  }
  
  return result;
}












function SodaMix(String whichSoda)
{
  displayInvLook(String.Format("I'm not putting %s in the %s.", player.ActiveInventory.Name, whichSoda), 
                 String.Format("I'm qualified to go mixing %s into this %s", player.ActiveInventory.Name, whichSoda));  
}




static bool Inventory::universalInteraction(InventoryItem *theItem, CursorMode mode)
{
  
  InventoryItem *playerInv = player.ActiveInventory;
  String playerInvName;
  String capitalisedInv;
  String theString;
  
  if(playerInv != null)
  {
    playerInvName = playerInv.Name;
    capitalisedInv = HandyHelper.capitaliseSentence(playerInvName);
  }
  
  switch(theItem)
  {
    case iSodaSizzle:
      if(mode == eModeLookat)
      {
        displayInvLook("It's Sizzle. The BBQ beverage which doesn't fizz, it sizzles.", 
                        "Sizzle, it's a sausage flavoured carbonated beverage.");
      } else {        
        SodaMix("Sizzle");        
      }
    break;
    case iSodaYelloWater:
      if(mode == eModeLookat)
      {
        displayInvLook("'It has the colour and consistency of stale urine.'", "Yello Water!");
        displayInvLook("'But the taste of Yello Water is... Fine.'", "My favourite!");
      } else {
        SodaMix("Yello Water");
      }
    break;
    case iSodaAids:
      if(mode == eModeLookat)
      {
        displayInvLook("'Aid's: Restore, revive, repeat.'", "Aid's is some kind of health drink.");
      } else {
        SodaMix("Aid's");
      }
    break;
    case iSodaLimpGush:
      if(mode == eModeLookat)
      {
       displayInvLook("It has a strangely familiar quality I can't quite put my finger on.", 
                      "Tastes like... Um...");
      } else {
        SodaMix("Limp Gush");
      }
    break;
    case iSodaCoalCola:
      if(mode == eModeLookat)
      {
        displayInvLook("Coal Cola, with more than just a hint of coal.", "Coal Cola.");
        displayInvLook("A drink for real manly men.", "Tastes kind of bitter and smokey.");
      } else {
        SodaMix("Coal Cola");
      }
    break;
    case iSodaJohn414:
      if(mode == eModeLookat)
      {
        displayInvLook("It has subtle notes of citrus, with floral undertones.", "'Whoever drinks the water I give will never thirst,");
        displayInvLook("I'm pretty sure it's owned by a church for a tax dodge or something.", "John 4:14! Quench your spirit first!'");
      } else {
        SodaMix("John 4:14");
      }
    break;
    case iSodaBeige:
      if(mode == eModeLookat)
      {
        displayInvLook("Eh, it's okay I guess.", "It has no discernible flavour.");
      } else {
        SodaMix("Beige");
      }
    break;
    case iPills:
      if(mode == eModeLookat)
      {
        if(IsPlayerAbi){
        Print("It's Paul's pills.");    
        Print( "You should always read the small print on these things!");
        Print("hmmm...");
        Print("'Do not combine with drugs or alcohol. May result in delerium, hallucinations.'");
        } else {
          Print("It's a jumbo size bottle of emotional stabilizing pills!");
        } 
      } else {
        if(player.ActiveInventory == iPaulsCard || player.ActiveInventory == iAbiCard)
        {
          displayInvLook("I don't want to mess with Paul's pills!",
                          "Crush them up for lines? Sounds like a bit of effort.");
        } else if (player.ActiveInventory == iWineCask)
        {
          displayInvLook( "You're not meant to mix those pills with alcohol!", 
                          "That's not the way to wash those pills down with wine!");
        } else {
          displayInvLook("I don't want to go messing with Paul's medication too much.",
                          "That won't do anything useful to the pills");
        }   
      }
    break;
    case iKeyCard:
      if(mode == eModeLookat)
      {
         displayInvLook(  "It's the keycard to the stationery closet!",
                          "It's some kind of key-card.");
      } else {
         displayInvLook( "I'd better not mess with this keycard.",
                          "That might wreck the key-card?");
      }
    break;
    case iPaulsCard:
    if(mode == eModeLookat)
    {
      lookEftposCards(iPaulsCard);
    } else {       
        displayInvLook("That'll only make it worse!",
                       "My card is fine without that.");        
    }
    break;
    case iAbiCard:
    if(mode == eModeLookat)
    {
      lookEftposCards(iAbiCard);
    } else {      
        displayInvLook("Nah, that'll wreck it.",
                        "It'll probably piss off Abi if I break her card.");     
    }
    break;
    case iTypewriter:
    if(mode == eModeLookat)
    {
      displayInvLook("It's Paul's precious typewriter.",
                    "It's my typewriter. I'm gonna write something amazing when I get round to it!");
  
    } else {
      if(player.ActiveInventory == iTypewriter)
        {
          Mouse.Mode = eModeInteract;
        } else {
          displayInvLook("I'd better not meddle with this old peice of crap.",
                          "Nah, that'll probably mess with the mechanism.");
        }
    }
    break;
    case iBeeperAbi:
    if(mode == eModeLookat)
    {
       Beepers.showAbisBeeper();
    } else {
       theString = String.Format("But this beeper is more fragile than a Tamagochi! %s might ruin it!", playerInvName);
       displayInvLook( theString,
                        "If this beeper breaks while I have it, Abi will blame it on me!");
    }
    break;
    case iToiletPaper:
    if(mode == eModeLookat)
    {
      if(countToiletPaper() > 1)
      {
        int amount = countToiletPaper();
        theString = String.Format("I've got %s rolls of toilet paper.", HandyHelper.stringifyInt(amount));
        displayInvLook(theString, theString);
        if(countToiletPaper() > 2)
        {
          displayInvLook("I feel strangely comforted by this.",
                         "These will be worth a lot of money one day.");
        }
      } else {
        displayInvLook( "It's a toilet roll.",
                      "A roll of toilet paper.");
      }
    } else {
        theString = String.Format("I don't see how %s would be better wrapped in toilet paper.", playerInvName);
        displayInvLook(theString,
                "I might need the toilet paper later, for you know, it's traditional use.");
    }
    break;
    case iMug:
    if(mode == eModeLookat)
    {
       displayInvLook("It's a crappy mug from the Omnichron Staff room.",
                  "It's the mug Abi gave me, as present, I think...");
    } else {
      if(player.ActiveInventory == iMilk)
      {
        replaceInvItem(iMug, iMugMilk);
        player.LoseInventory(iMilk);
        aMilk.Play(eAudioPriorityHigh, eOnce);
      } else if (player.ActiveInventory == iWineCask)
      {
        replaceInvItem(iMug, iMugWine);
        Inventory.reduceCaskWine();
        aMilk.Play(eAudioPriorityHigh, eOnce);
      } else {
        theString = String.Format("I don't think %s would go in the mug.", playerInvName);
        displayInvLook(theString, theString);
      }
    }
    break;
    case iCoffeeBlack:
    if(mode == eModeLookat)
    {
       displayInvLook("A mug of black coffee.",
                      "Abi gave me this black coffee. Looks shitty, but it was a nice gesture anyway.");
    } else {
      if(player.ActiveInventory == iMilk)
      {
        aMilk.Play(eAudioPriorityHigh, eOnce);
        replaceInvItem(iCoffeeBlack, iCoffeeLatte);
        player.LoseInventory(iMilk);
      } else {
        theString = String.Format("I'm not going to put %s in the coffee!", playerInvName);
        displayInvLook(theString, theString);
      }
    }
    break;
    case iCoffeeLatte:
      if(mode == eModeLookat)
      {
        displayInvLook("A mug of coffee, with milk.",
                        "It's a latte.");
      } else {
          theString = String.Format("I'm not going to put %s in the coffee!", playerInvName);
          displayInvLook(theString, theString);
      }
    break;
    case iMilk:
      if(mode == eModeLookat)
      {
        displayInvLook("Milk, the way nature intended it - lactated from the mucousy mammaries of a cow.","Moo milk!");
      } else {
        theString = String.Format("I'm not going to put %s in the milk!", playerInvName);
        displayInvLook(theString, theString);
      }
    break;
    case iMugMilk:
      if(mode == eModeLookat)
      {
          displayInvLook("It's a mug of milk.",
                        "It's a stale mug of room-temperature milk.");
      } else {
         theString = String.Format("I'm not going to put %s in the milk!", playerInvName);
          displayInvLook(theString, theString);
      }
    break;
    case iCakeSlice:
    if(mode == eModeLookat)
    {
       displayInvLook("Chocolate cake:", "Delicious.");
        displayInvLook("Fresh from the discount baking section at the supermarket.","Some kind of fancy chocolate cake.");
      
    } else {
      if(player.ActiveInventory == iPills)
      {
        displayInvLook("Hide the pills in the cake?",
                       "Seems like a waste of pills.");
        displayInvLook("Nah, Paul doesn't need any encouragement to take his medicine.",
                       "...And cake...");
      } else {
        Print(String.Format("%s will ruin it!",  capitalisedInv));        
      }
    }
    break;
    case iPaperReam:
    if(mode == eModeLookat)
    {
      displayInvLook("It's a ream of paper.",
                      "Some A4 paper.");
    } else {
      displayInvLook( "Nah...",
                "I don't think so.");
    }
    break;
    case iHouseKeys:
    if(mode == eModeLookat)
    {
      if(IsPlayerAbi)
      {
        Print("It's my house-key.");
      }
      displayInvLook("The flat's address was conveniently printed on the tag by the rental company.",
                     "It's Abi's house-key... I think I left mine in the 1960's...");
      displayInvLook("'Please return to: 13 Home St, Newton Gully, Bucklame.'",
                     "I left a bunch of stuff back there by mistake.");       
    } else {
       Print(String.Format("There's no need to rub %s all over the key.", playerInvName));
    }
    break;
    case iInfiniteJest:
    if(mode == eModeLookat)
    {
       displayInvLook( "It's Paul's copy of Infinite Jest.",
                  "It's my favourite book:");
       displayInvLook( "There's a book-mark on page twelve.",
                      "Infinite Jest by David Foster Wallace.");      
    } else {
        displayInvLook(String.Format("There's no way %s or anything else will improve the book.", playerInvName) ,
                        "No, let's not mess with the book.");
    }
    break;
    case iWineCask:
    if(mode == eModeLookat)
    {
      displayInvLook( "Cheap nasty box-wine.",
                "Delicious cask of Country Soft Red Wine.");
                
      Print(String.Format("%s", howFullWine()));                
      
    } else {
       displayInvLook("Nah... Nothing can improve this shitty wine.",
                      "The wine is perfect as it is.");
    }
    break;
    case iGoonBag:
     if(mode == eModeLookat)
    {
        displayInvLook("It's an empty wine bag.","It's the naked, empty wine sack.");
        displayInvLook("I guess the box was lost somehow?","Evocative.");
    } else {
        displayInvLook( "I don't see how that will affect the wine sack.",
                  "That won't make it full again!");
    }
    break;
    case iCaskInflated:
     if(mode == eModeLookat)
    {
      displayInvLook( "It's an inflated goon-bag.",
                "It's a puffed up wine-cask.");
    } else {
     if(IsPlayerAbi)
      {
        theString = String.Format("I don't see how %s will affect the goon-bag.", playerInvName);
      } else {
        theString = String.Format("How would I combine %s with the goon-bag?", playerInvName);
      }
      Print(theString);
        }
    break;
    case iMugWater:
     if(mode == eModeLookat)
    {        
        displayInvLook("It's a boring old cup of water.", 
                  "A glorious cup of clean drinking water!");
    } else {
        theString = String.Format("I'm not going to put %s in the water!", playerInvName);
        displayInvLook(theString, theString);
    }
    break;
    case iMugWine:
     if(mode == eModeLookat)
    {
      displayInvLook("Box wine, now in a cup!", 
               "Red wine, it tastes like stale Ribena");
    } else {
      theString = String.Format("I'm not going to put %s in the wine!", playerInvName);
      displayInvLook(theString, theString);
    }
    break;
    case iCoffeeWine:
     if(mode == eModeLookat)
    {
      displayInvLook("Coffee and wine, together!", "Coffee and wine, is there even a name for this beverage?");
      displayInvLook("Genius!", "brown wine?");
    } else {
      displayInvLook(String.Format("Let's not get carried away with these cocktails. %s in the coffee-wine is too far.", capitalisedInv), 
                      String.Format("I think the brown wine is fine without %s", playerInvName)
      );
    }
    break;
    
    default:
    Display("Unhandled item!");
    break;
  }
}

/*

{
 
}
static void Inventory::inv_keyCard_inv()
{
 

Coal Cola—it's the best!
Interrupt the weak,
Grow hair on chest,
Shake a hand with the mightiest grip,
Coal Cola, the strongest sip!

for minors,  not for minors!

    if(mode == eModeLookat)
    {
      
    } else {
      
    }

*/


function repeatedly_execute()
{
  disappearDrinkRepEx();
}