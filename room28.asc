// room script file
int currentPhoneme = 0;

function getPhonemeStressNum()
{ 
  if(TotalLipSync.GetCurrentPhoneme()!= null)
  {
    String theString = TotalLipSync.GetCurrentPhoneme();
    if(theString.EndsWith("1"))
    {
      currentPhoneme = 1;
    } else if (theString.EndsWith("2"))
    {
      currentPhoneme = 2;
    } else if(theString.EndsWith("3"))
    {
      currentPhoneme = 3;
    } else if(theString.EndsWith("4"))
    {
      currentPhoneme = 4;
    }else if(theString.EndsWith("5"))
    {
      currentPhoneme = 5;
    } else if (theString.EndsWith("6"))
    {
      currentPhoneme = 6;
    } else
    {
      currentPhoneme = 0;
    }
  } else {
    currentPhoneme = 0;
  }
}

function crossEye()
{
    oLeftEye.Graphic = 3715;
  
}

function wallEye()
{
   
    oLeftEye.Graphic = 3713;
}

function squint()
{
  oEyesExpression.SetView(230, 1, 0);
  oEyesExpression.Animate(1, 3, eOnce, eNoBlock);
}
function unSquint()
{
  oEyesExpression.SetView(230, 1, 2);
  oEyesExpression.Animate(1, 3, eOnce, eNoBlock, eBackwards);
}

function raiseBrows()
{
 oLeftEye.TweenPosition(0.2, 138, 65,  eEaseLinearTween, eNoBlockTween);
  oBrows.TweenY(0.1, 54, eEaseInSineTween, eNoBlock);
  //oEyesExpression.Graphic = 3711;
  unSquint();
}

function normalBrows()
{
  //oLeftEye.TweenPosition(0.2, 141, 65,  eEaseLinearTween, eNoBlockTween, 0.1);
  oBrows.TweenY(0.1, 56, eEaseInSineTween, eNoBlockTween);
   oLeftEye.TweenPosition(0.1, 141, 65,  eEaseLinearTween, eNoBlockTween);
  //oEyesExpression.Graphic = 3708;
}

function lowerBrows()
{
  
  oBrows.TweenY(0.1, 59, eEaseInSineTween, eNoBlockTween);
  oEyesExpression.Graphic = 3709;
  squint();
}

function landLordSpeak(String llSaid)
{
   cLandLordCUSIde.SayAtSync(220, 85, 120, llSaid);  
}

function repexRaiseBrows()
{
  if(currentPhoneme == 1)
  {
    raiseBrows();
  }
}

function repexNormBrows()
{
  if(currentPhoneme == 2)
  {
    normalBrows();
  }
}

function repexLowerBrows()
{
  if(currentPhoneme == 3)
  {
    lowerBrows();
  }
}


function shot22()
{
  //oLeftEye.TweenPosition(0.2, 141, 65,  eEaseLinearTween, eNoBlockTween, 0.3);
   cABiCReturn.SayAtSync(220, 70, 120, "&40 You're allowed to knock you know.");
   Cutscenes.nextCutSceneShot();
}

function shot27()
{
  oEyesExpression.Animate(2, 3, eOnce, eNoBlock, eForwards);
  landLordSpeak("&13 If this continues,");
  Cutscenes.nextCutSceneShot();
}

function shot39()
{
  WaitSeconds(1.0);
  wallEye();
  
  oEyesExpression.Animate(3, 1, eOnce, eNoBlock, eBackwards);
  oLeftEye.TweenPosition(0.1, 141, 65, eEaseLinearTween, eNoBlockTween);
   oBrows.TweenY(0.1, 59, eEaseInSineTween, eNoBlockTween);
   landLordSpeak("&27 I don't want to have to");
  Cutscenes.nextCutSceneShot();
}

function shot41()
{
  landLordSpeak("&29 heh heh heh");
  EndCutscene();
}



function room_AfterFadeIn()
{
  if(cutSceneShot == 22)
  {
    shot22();
  } else if (cutSceneShot == 27)
  {
    shot27();
  }  else if (cutSceneShot == 39)
  {
    shot39();
  } else if (cutSceneShot == 41)
  {
    shot41();
  }
 
}
//134 69
function setEyes(int xOffset, int yOffset)
{
  oLeftEye.X = 141 + xOffset;
  oLeftEye.Y = 65 + yOffset;
}

function room_Load()
{
  cLandLordCUSIde.Transparency = 100;
  
  if(cutSceneShot == 22)
  {
   setEyes(0, 0);
  } else if (cutSceneShot == 27)
  {
    oEyesExpression.SetView(230, 2, 0);
  }  else if (cutSceneShot == 39)
  {
    oArm.Visible = true;
    setEyes(-4, 1);
    oEyesExpression.SetView(230, 3, 1);
    oBrows.Y = 57;
    crossEye();
  } else if (cutSceneShot == 41)
  {
    
  }
}


function late_repeatedly_execute_always()
{
  getPhonemeStressNum();
  repexLowerBrows();
  repexNormBrows();
  repexRaiseBrows();
}