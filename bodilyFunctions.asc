//handles gross toilet stuff

/*
  At the moment max toilet points is 4, which corresponds to the loop number for the shitting/pissing animation.
  
  there needs to be a better system so you can eat more food/ drinks
  
  so for example the actual custom character property goes up to 12, make it a float, 
  divide by 3 return to int to get a whole value between 0 and 4
  

*/

int thirtyToFour(int thirty)
{
  
  if      (thirty < 5)  { return 0; } 
  else if (thirty < 12) { return 1; }
  else if (thirty < 18) { return 2; }
  else if (thirty < 22) { return 3; }
  else                  { return 4; }
  
}

function showToilet(this Character*, popup pos)
{
  int charWidth = 13;
  int position;
  if(pos == eCentredOfChar){     position = charWidth - 20;   }
  else if(pos == eRightOfChar){  position = charWidth + 12;   }
  else if(pos == eLeftOfChar){   position = - charWidth - 20;   }
  
  gToilet.X = this.x - Game.Camera.X + position;
  gToilet.Y = this.y - Game.Camera.Y - 60;
  gToilet.Visible = true;
  btnPiss.NormalGraphic = 28-(thirtyToFour(this.GetProperty("bladder"))*7)+873;
  btnShit.NormalGraphic = 28-(thirtyToFour(this.GetProperty("stomach"))*7)+902;
}
 
function hideToilet()
{
  //called from global
  gToilet.Visible = false;
  currentlyPissing = false;   
}



function piss(this Character*, popup pos)
{
  if(thirtyToFour(this.GetProperty("bladder")))
  {
    this.showToilet(pos);
    btnPiss.Animate(19, thirtyToFour(this.GetProperty("bladder")), 1, eOnce);
    this.SetProperty("bladder", 0);
    currentlyPissing = true;
  } else {
    this.Say("I don't need to go.");
  }
}

function shit(this Character*, popup pos)
{
  if(thirtyToFour(this.GetProperty("stomach")))
  {
    this.showToilet(pos);
    btnShit.Animate(20, thirtyToFour(this.GetProperty("stomach")), 1, eOnce);
    this.SetProperty("stomach", 0);
    currentlyPissing = true;
  } else {
    this.Say("I don't want to go!");
  }
}

bool pooWees(this Character*, popup pos)
{
  if(thirtyToFour(this.GetProperty("stomach")) + thirtyToFour(this.GetProperty("bladder")) > 0)
  {
    this.showToilet(pos);
    btnShit.Animate(20, thirtyToFour(this.GetProperty("stomach")), 1, eOnce);
    btnPiss.Animate(19, thirtyToFour(this.GetProperty("bladder")), 1, eOnce);
    this.SetProperty("stomach", 0);
    this.SetProperty("bladder", 0);  
    currentlyPissing = true;
    return true;
  } else {
    this.Say("I don't need to...");
    return false;
  }
}

/********************************Health bar stuff******************************/

function init_Health()
{
  btnHealthBar.NormalGraphic = 18;
  gHealth.Visible = false;  
}

function showHealth(this Character*)
{
  aLifebar.Play(eAudioPriorityNormal, eOnce);
  
  btnHealthBar.Width = this.GetProperty("HP") + 1;
  //btnHealthBar.NormalGraphic = getHPFrame(this.GetProperty("HP"));
  //btnHealthBar.NormalGraphic = 50 - this.GetProperty("HP") + 1376;
  gHealth.X = this.x - Game.Camera.X - 27;
  gHealth.Y = this.y - Game.Camera.Y - 80;
  gHealth.Visible = true;
  SetTimer(1, 100);
  healthIsHiding = true; 
  player.StopMoving();
}


function addHealth(this Character*, int amountToAdd)
{
  int prevHP = this.GetProperty("HP");
  if(prevHP == 50 && amountToAdd > 0)
  {
    //already full health, health bar can flash or something, different sound effect
  } else {
    int newHP = prevHP + amountToAdd;
    if(newHP < 5)
    {
      newHP = 2;
      //this is where a character will faint and wake up in hospital
    } else if (newHP > 50)
    {
      newHP = 50;
    }
    btnHealthBar.Width = this.GetProperty("HP") + 1;
    gHealth.X = this.x - Game.Camera.X - 27;
    gHealth.Y = this.y - Game.Camera.Y - 80;
    gHealth.Visible = true;
    SetTimer(1, 100);
    healthIsHiding = true;   
    btnHealthBar.TweenSize(1.0, newHP + 1, btnHealthBar.Height, eEaseOutCubicTween, eNoBlock, 0.2);
    this.SetProperty("HP", newHP);
  }
}

  function hideHealth()
{
  gHealth.TweenTransparency(0.1, 100, eEaseInSineTween, eBlockTween);
  gHealth.Visible = false;
  gHealth.Transparency = 0;
}
