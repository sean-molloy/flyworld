// room script file
bool liftInMotion;
function room_Load()
{
  changePlayerLocaleOnRoomEnter();
  player.PlaceOnWalkableArea();
  liftInMotion = false;
  if(player.PreviousRoom == 14)
  {
    Game.Camera.SetAt(0, 40);
  }
  if(characterChange)
  {
    characterChange = false;
  }
}

function room_AfterFadeIn()
{
  if(paulAwake)
  {
    btnChch.Visible = false;
  }
}
  
function room_Leave()
{
  if(paulAwake)
  {
    btnChch.Visible = true;
  }
}

/**********************custom functions****************************************************/
float liftTime = 10.0;
bool goingDownNotUp;

function liftGoDown()
{
  goingDownNotUp = true;
  aElevatorfall.Play(eAudioPriorityHigh, eOnce);
  oLiftShaft.TweenPosition(liftTime, 225, 200, eEaseInOutSineTween, eNoBlockTween);
  Game.Camera.TweenY(7.0, 0, eEaseInCircTween, eNoBlockTween);
  SetTimerWithSeconds(16, 7.0);
  SetTimerWithSeconds(17, liftTime );
}

function liftGoUp()
{
  aElevatorfall.Play(eAudioPriorityHigh, eOnce);
  goingDownNotUp = false;
  oLiftShaft.TweenPosition(liftTime, 225, 1906, eEaseInOutSineTween, eNoBlockTween);
  Game.Camera.TweenY(liftTime, 40, eEaseInOutCircTween, eNoBlockTween);
//  SetTimerWithSeconds(16, 7.0);
  SetTimerWithSeconds(17, liftTime );
}

function pushLiftButton()
{
  //animate char pushing button
  aLiftButton.Play(eAudioPriorityHigh, eOnce);
  WaitSeconds(1.2);
  if(!liftInMotion)
    liftInMotion = true;
    {
    if(player.PreviousRoom == 14)
    {
      liftGoDown();
    } else {
      liftGoUp();
    }
  }
}

function openDoors()
{
  TweenShakeScreen(0.2, 5, 5, 5, 5, eEaseInCircTween, eBlockTween);
  if(goingDownNotUp)
  {
    player.ChangeRoom(16, player.x + 260, player.y - 70);
    //get out at ground level
  } else {
    player.ChangeRoom(14, player.x + 478, player.y - 40);
    //get out at office
  }
}


function room_RepExec()
{
 
  if(IsTimerExpired(16))
  {
    if(goingDownNotUp)
    {
      Game.Camera.TweenY(3.0, 70, eEaseOutBounceTween, eNoBlockTween);
    } 
  }
  
  if(IsTimerExpired(17))
  {
    openDoors();
  }
}



/**************************Interaction*******************************************************/

function hLiftButton_AnyClick()
{

  switch (verbUsed)
  {
    case 0: //walk
      walkToAndFace(248, 173, eDirectionLeft, 260, 174); 
    break;
    case 1://look
      player.FaceLocation(240, 176, eBlock);
      lookAbiPaul("It's the controls for the lift.", "The elevator's buttons.");
    break;
    case 2://use
      pushLiftButton();
    break;
    case 3://talk
      noTalking();
    break;
    case 4://move
      pushLiftButton();
    break;
    case 5://fourletters
      fuckAnyone();
    break;
    case 6://take
      cantTake();
    break;
    case 7://inv
      wontWork();
    break;
  }
  verbUsed = 0;

}


