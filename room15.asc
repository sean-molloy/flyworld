//lift script;


bool liftInMotion;
function room_Load()
{
  Time.FreezeTime();
  changePlayerLocaleOnRoomEnter();
  player.PlaceOnWalkableArea();
  liftInMotion = false;
  if(player.PreviousRoom == eRooms_Omni_CorridorRight)
  {
    Game.Camera.SetAt(0, 40);
  }
  if(characterChange)
  {
    characterChange = false;
  }
}

function room_AfterFadeIn()
{
  if(paulAwake)
  {
    btnChch.Visible = false;
  }
}
  
function room_Leave()
{
  Time.FreezeTime(false);
  if(paulAwake)
  {
    btnChch.Visible = true;
  }
}

/**********************custom functions****************************************************/




float liftTime = 10.0;
bool goingDownNotUp;

function liftGoDown()
{
  StartCutscene(eSkipESCOnly);
  goingDownNotUp = true;
  aElevatorfall.Play(eAudioPriorityHigh, eOnce);
  oLiftShaft.TweenPosition(liftTime, 225, 200, eEaseInOutSineTween, eNoBlockTween);
  Game.Camera.TweenY(7.0, 0, eEaseInCircTween, eNoBlockTween);
  SetTimerWithSeconds(16, 7.0);
  SetTimerWithSeconds(17, liftTime );
}

function liftGoUp()
{
  StartCutscene(eSkipESCOnly);
  aElevatorfall.Play(eAudioPriorityHigh, eOnce);
  goingDownNotUp = false;
  oLiftShaft.TweenPosition(liftTime, 225, 1906, eEaseInOutSineTween, eNoBlockTween);
  Game.Camera.TweenY(liftTime, 40, eEaseInOutCircTween, eNoBlockTween);
//  SetTimerWithSeconds(16, 7.0);
  SetTimerWithSeconds(17, liftTime );
}

function pushLiftButton()
{
  //animate char pushing button
  aLiftButton.Play(eAudioPriorityHigh, eOnce);
  WaitSeconds(1.2);
  if(!liftInMotion)
    liftInMotion = true;
    {
    if(player.PreviousRoom == eRooms_Omni_CorridorRight)
    {
      liftGoDown();
    } else {
      liftGoUp();
    }
  }
}

function changeRoomFromLift(Character* theChar, int theRoom)
{
  int x, y;
  
  if(theRoom == eRooms_Omni_CorridorRight)
  {
    x = 478;
    y = 40;
    theChar.ChangeRoom(theRoom, theChar.x + x, theChar.y - y);
  } else if (theRoom == eRooms_Omni_Lobby)
  {
    x = 276;
    y = 101;
    theChar.ChangeRoom(theRoom, x, y);
  }    
}

function npcChangeRoomFromLift(Character* theChar, int theRoom)
{
  if(theChar.Room == eRooms_Omni_Lift)
  {
    changeRoomFromLift(theChar, theRoom);
  }  
}

function openDoors()
{
  TweenShakeScreen(0.2, 5, 5, 5, 5, eEaseInCircTween, eBlockTween);
  if(goingDownNotUp)
  {
    changeRoomFromLift(player, eRooms_Omni_Lobby);     
    npcChangeRoomFromLift(cJohn, eRooms_Omni_Lobby);          
    npcChangeRoomFromLift(cHamish, eRooms_Omni_Lobby);          
    npcChangeRoomFromLift(cBob, eRooms_Omni_Lobby);          
    npcChangeRoomFromLift(cFred, eRooms_Omni_Lobby);          
    npcChangeRoomFromLift(cSally, eRooms_Omni_Lobby);          
           
    //get out at ground level
  } else {
    
    Employees_Omni.putCharsInPlace();
    changeRoomFromLift(player, eRooms_Omni_CorridorRight);        
    npcChangeRoomFromLift(cJohn, eRooms_Omni_CorridorRight);        
    npcChangeRoomFromLift(cHamish, eRooms_Omni_CorridorRight);        
    npcChangeRoomFromLift(cFred, eRooms_Omni_CorridorRight);        
    npcChangeRoomFromLift(cBob, eRooms_Omni_CorridorRight);        
    npcChangeRoomFromLift(cSally, eRooms_Omni_CorridorRight);        
  }
}


function room_RepExec()
{
 
  if(IsTimerExpired(16))
  {
    if(goingDownNotUp)
    {
      Game.Camera.TweenY(3.0, 70, eEaseOutBounceTween, eNoBlockTween);
    } 
  }
  
  if(IsTimerExpired(17))
  {
    openDoors();
  }
}



/**************************Interaction*******************************************************/

function hLiftButton_AnyClick()
{

  switch (verbUsed)
  {
    case 0: //walk
      walkToAndFace(248, 173, eDirectionLeft, 260, 174); 
    break;
    case 1://look
      player.FaceLocation(240, 176, eBlock);
      lookAbiPaul("It's the controls for the lift.", "The elevator's buttons.");
    break;
    case 2://use
      pushLiftButton();
    break;
    case 3://talk
      Canned.noTalking();
    break;
    case 4://move
      pushLiftButton();
    break;
    case 5://fourletters
      Canned.fuckAnyone();
    break;
    case 6://take
      Canned.cantTake();
    break;
    case 7://inv
      Canned.wontWork();
    break;
  }
  verbUsed = 0;

}


