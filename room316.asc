// room script file

function room_Load()
{
  oBlink.SetView(217, 1, 0);
  oSquintBrows.SetView(217, 3, 0);
  oRaiseBrows.SetView(217, 4, 0);
  oWorry.SetView(217, 5, 0);
}

int counter = 0;
bool blinkingAllowed = true;
int dryEyes = 50;
bool currentlyBlinking = false;
function paulBlink()
{
  if(blinkingAllowed)
  {
    counter++;    
    if(counter > dryEyes)
    {
      if(currentlyBlinking)
      {
        if(oBlink.Frame > 4)
        {
          dryEyes = 70 + Random(100);
          oBlink.SetView(217, 1, 0);
          counter = 0;   
          currentlyBlinking = false;
        }
      } else {
        oBlink.Animate(1, 5, eOnce, eNoBlock, eForwards, 0);
        currentlyBlinking = true;
      }      
    }    
  }
}
int eyePos = 162;
function moveEyes()
{
  oPaulEyes.TweenY(2.0, eyePos + 6, eEaseInBackTween, eNoBlockTween);
}
function moveEyesBack()
{
  oPaulEyes.TweenY(1.0, eyePos, eEaseInOutSineTween, eNoBlockTween, 1.0);
}

function squint()
{
  oSquintBrows.Animate(3, 3, eOnce, eNoBlock, eForwards);
  blinkingAllowed = false;
}
function unSquint()
{
  oSquintBrows.Animate(3, 3, eOnce, eNoBlock, eBackwards);
  blinkingAllowed = true;
}

int currentPhoneme = 0;

function raiseBrows()
{
  if(currentPhoneme == 1)
  {
    oRaiseBrows.Visible = true;
    oRaiseBrows.Animate(4, 4, eOnce, eNoBlock, eForwards);
    currentPhoneme = 0;
  }
}

function unRaiseBrows()
{
  if(currentPhoneme == 2)
  {
    oRaiseBrows.Animate(4, 4, eOnce, eNoBlock, eBackwards);
    currentPhoneme = 0;
  }
}

function worry()
{
  if(currentPhoneme ==3)
  {
    oWorry.Visible = true;
    oWorry.Animate(5, 4, eOnce, eNoBlock, eForwards);
    currentPhoneme = 0;
  }
}

function unWorry()
{
  if(currentPhoneme ==4)
  {
    oWorry.Animate(5, 4, eOnce, eNoBlock, eBackwards);
  }
}


function getPhonemeStressNum()
{ 
  if(TotalLipSync.GetCurrentPhoneme()!= null)
  {
    String theString = TotalLipSync.GetCurrentPhoneme();
    if(theString.EndsWith("1"))
    {
      currentPhoneme = 1;
     }  else if (theString.EndsWith("2"))
     {
       currentPhoneme = 2;
    
     }else if (theString.EndsWith("3"))
     {
       currentPhoneme = 3;
    
     }else if (theString.EndsWith("4"))
     {
       currentPhoneme = 4;
    
     }  else
    {
      currentPhoneme = 0;
    }
  } else {
    currentPhoneme = 0;
  }
}


function late_repeatedly_execute_always()
{
  getPhonemeStressNum();
  paulBlink(); 
  raiseBrows();
  unRaiseBrows();
  worry();
  unWorry();
}

function paulSpeak(String paulSaid)
{
   cUPaul.SayAtSync(00, 40, 360, paulSaid);  
}


function abiSpeak(String abiSaid)
{
  cAbiCLeaves.SayAt(0, 30, 100, abiSaid);
}
function shot9()
{
  
  moveEyes();
  
  squint();
  paulSpeak("&3 all control has been taken away and events unfold");
  moveEyesBack();  
  paulSpeak("&4 like some subpar, amatuer cartoon show.");  
  unSquint();
  cutSceneShot = 10;
  player.ChangeRoom(325);
}

function shot11()
{
  paulSpeak("&9 Everything else is merely a distraction from our doom.");
  cutSceneShot = 12;
  player.ChangeRoom(326);
}

function shot24()
{
   paulSpeak("&22 Callum's the other guy.");   
   cutSceneShot = 25;
  player.ChangeRoom(321);
}

function shot14()
{
  cAbiCLeaves.SayAt(310, 30, 50, "&99 What?");
 
  blinkingAllowed = false;
  oPaulEyes.X = 186;
  WaitSeconds(0.5);
  squint();
  paulSpeak("&12 *sigh*");
  unSquint();
  paulSpeak("&13 nothing");
  oShadow.SetView(217, 6, 0);
  oShadow.Visible = true;
  
  oShadow.Animate(6, 2, eOnce, eNoBlock, eForwards);
  WaitSeconds(0.5);
  cAbiCLeaves.SayAt(160, 30, 50, "&32 Eh?");
  
  WaitSeconds(0.1);
  cAbiCLeaves.SayAt(80, 30, 50, "&34 What?");
  
  blinkingAllowed = true;
 
  oPaulEyes.TweenX(0.3, 184, eEaseLinearTween, eNoBlockTween);
  paulSpeak("&15 Me and Lily...");
  
  cutSceneShot = 15;
  player.ChangeRoom(328);
 
}

function shot16()
{
  
  paulSpeak("&18 like ships in the night towards the end.");
 
   cutSceneShot = 17;
   player.ChangeRoom(328);
}

function shot18()
{
  squint();
  WaitSeconds(1.0);
  unSquint();
  WaitSeconds(0.3);
  
  moveEyes();
  raiseBrows();
  paulSpeak("&19 Yeah...");
  moveEyesBack();
  WaitSeconds(0.2);
  paulSpeak("&20 I guess I'll just have to pay half rent from now on.");
  cutSceneShot = 19;
  player.ChangeRoom(328);
}

function shot28()
{
  cLandLord.SayAt(70, 50, 290, "&14 I may have to sell off some of my shares in");
  cutSceneShot = 29;
  player.ChangeRoom(27);
}
function script()
{  
  if(cutSceneShot ==9)
  {
  shot9();
  
  } else if (cutSceneShot == 11)
  {
    shot11();
  } else if (cutSceneShot == 14)
  { 
    shot14();
  } else if(cutSceneShot == 16)
  {
    shot16();
  } else if(cutSceneShot == 18)
  {
    shot18();
  } else if(cutSceneShot ==24)
  {
    shot24();
  } else if(cutSceneShot == 28)
  {
    shot28();
  }
}

function room_AfterFadeIn()
{
  script();
  
  
}


function on_key_press(eKeyCode keycode)
{
  script();
}