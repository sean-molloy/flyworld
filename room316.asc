// room script file

function room_Load()
{
  oBlink.SetView(217, 1, 0);
  oSquintBrows.SetView(217, 3, 0);
  oRaiseBrows.SetView(217, 4, 0);
}

int counter = 0;
bool blinkingAllowed = true;
int dryEyes = 50;
bool currentlyBlinking = false;
function paulBlink()
{
  if(blinkingAllowed)
  {
    counter++;    
    if(counter > dryEyes)
    {
      if(currentlyBlinking)
      {
        if(oBlink.Frame > 4)
        {
          dryEyes = 70 + Random(100);
          oBlink.SetView(217, 1, 0);
          counter = 0;   
          currentlyBlinking = false;
        }
      } else {
        oBlink.Animate(1, 5, eOnce, eNoBlock, eForwards, 0);
        currentlyBlinking = true;
      }      
    }    
  }
}
int eyePos = 162;
function moveEyes()
{
  oPaulEyes.TweenY(2.0, eyePos + 6, eEaseInBackTween, eNoBlockTween);
}
function moveEyesBack()
{
  oPaulEyes.TweenY(1.0, eyePos, eEaseInOutSineTween, eNoBlockTween, 1.0);
}

function squint()
{
  oSquintBrows.Animate(3, 3, eOnce, eNoBlock, eForwards);
  blinkingAllowed = false;
}
function unSquint()
{
  oSquintBrows.Animate(3, 3, eOnce, eNoBlock, eBackwards);
  blinkingAllowed = true;
}

int currentPhoneme = 0;

function raiseBrows()
{
  if(currentPhoneme == 1)
  {
    oRaiseBrows.Visible = true;
    oRaiseBrows.Animate(4, 4, eOnce, eNoBlock, eForwards);
    currentPhoneme = 0;
  }
}

function unRaiseBrows()
{
  if(currentPhoneme == 2)
  {
    oRaiseBrows.Animate(4, 4, eOnce, eNoBlock, eBackwards);
  }
}




function getPhonemeStressNum()
{ 
  if(TotalLipSync.GetCurrentPhoneme()!= null)
  {
    String theString = TotalLipSync.GetCurrentPhoneme();
    if(theString.EndsWith("1"))
    {
      currentPhoneme = 1;
     }  else if (theString.EndsWith("2"))
     {
       currentPhoneme = 2;
    
     }  else
    {
      currentPhoneme = 0;
    }
  } else {
    currentPhoneme = 0;
  }
}


function late_repeatedly_execute_always()
{
  getPhonemeStressNum();
  paulBlink(); 
  raiseBrows();
  unRaiseBrows();
}

function paulSpeak(String paulSaid)
{
   cUPaul.SayAtSync(00, 40, 360, paulSaid);  
}

function shot1()
{
  
  moveEyes();
  
  squint();
  paulSpeak("&3 all control has been taken away and events unfold");
  moveEyesBack();  
  paulSpeak("&4 like some subpar, amatuer cartoon show.");  
  unSquint();
  cutSceneShot = 3;
  player.ChangeRoom(325);
}

function shot2()
{
  paulSpeak("&9 Everything else is merely a distraction from our doom.");
  player.ChangeRoom(326);
}

function shot3()
{
   //paulSpeak("&22 Callum's the other guy.");
   WaitSeconds(2.0);
  player.ChangeRoom(321);
}

function shot4()
{
  squint();
  paulSpeak("&11 so we can continue in our roles as perfect little consumers.");
}

function script()
{  
  if(cutSceneShot ==2)
  {
  shot1();
  
  } else if (cutSceneShot == 4)
  {
    shot2();
  } else if (cutSceneShot == 5)
  { 
    shot4();
  } else if(cutSceneShot ==10)
  {
    shot3();
  }
}

function room_AfterFadeIn()
{
  script();
  
  
}


function on_key_press(eKeyCode keycode)
{
  script();
}