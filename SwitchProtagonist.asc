function whichRoomIsOtherOne(){
    if(IsPlayerAbi){
      return cPaul.Room;
    } else {
      return cAbi.Room;
    }
}

function changePlayerLocaleOnRoomEnter()
{
  if(!characterChange)
  {
    player.SetProperty("locale", Room.GetProperty("locale"));
  }
}



function highlightNewPlayer()
{   aChch3.Play(eAudioPriorityNormal);
  if(cPaul.Room == cAbi.Room)
  {
    player.SetLightLevel(100);
    player.TweenLightLevel(0.5, 100,  1, eEaseOutBounceTween, eBlock);
    player.RemoveTint();
  }
}

function resetMouseMode()
{
  mouse.Mode = eModeWalkto;
}

function disableSwitchButton()
{
   btnChch.Enabled = false;
  SetTimer(2, 60);
}

function stopFollowingOnSwitch()
{
   if(followed)
  {
    followed = false;
    dAbiToPaul.SetOptionState(2, eOptionOn);
    dAbiToPaul.SetOptionState(3, eOptionOff);
    dPaulToAbi.SetOptionState(2, eOptionOn);
    dPaulToAbi.SetOptionState(3, eOptionOff);
  }
}

function tweenFromHallToHall()
{
  if(Find.findPlayer() != Find.findOtherPlayer())
  {
    int tweenerX;
    int tweenerY;
    switch(Find.findOtherPlayer())
    {
      case 0:
        tweenerX = rm1Pos0X;
        tweenerY = rm1Pos0Y;            
      break;
      case 1:
        tweenerX = rm1Pos1X;
        tweenerY = rm1Pos1Y;  
      break;
      case 2:
        tweenerX = rm1Pos2X;
        tweenerY = rm1Pos2Y;  
      break;
      default:
      Display("error");
      break;
    }
    Game.Camera.StopAllTweens();
    Game.Camera.TweenPosition(1.7, tweenerX, tweenerY,  eEaseOutSineTween, eNoBlock);   
    characterChange = false;
  }
}

function changePhoneVolumeWhenRinging()
{
  if(phoneRinging!=null)
    {
      if(phoneRinging.IsPlaying)
      {
        phoneRinging.Volume = 30;        
      }
    }
}

function tweenFromHallToOtherRooms()
{
  float timeToTween = 0.7;
  int tweenerX = 0;
  int tweenerY = 0;
  switch( Find.whichRoomIsOtherOne() ){
    case 2:
      //pan to kitchen    
      tweenerX = 406;       
    break;
    case 3:
      //pan to lounge
      tweenerX = 309;      
    break;
    case 4:
      //pan to pauls room
      tweenerX = 400;
      tweenerY = 95;      
    break;
    case 5:
      //pan to abis room
      tweenerY = 32;       
    break;
    case 6:
      tweenerX = 180;       
    break;
    default:
      tweenerX = Game.Camera.X;
      tweenerY = Game.Camera.Y;
      timeToTween = 0.01;
    break;
    }
    Game.Camera.TweenPosition(timeToTween,  tweenerX,  tweenerY,  eEaseOutSineTween, eBlockTween); 
}

function tweeningfromTheHall()
{
  if(cPaul.GetProperty("locale") == 1 && cAbi.GetProperty("locale") == 1)
  {
    if(player.Room == 1)
    {
      if(Find.whichRoomIsOtherOne() == 1)
      {
        tweenFromHallToHall();
        characterChange = false;
      } else {
        tweenFromHallToOtherRooms();
        changePhoneVolumeWhenRinging();
      }
    }
  } 
}

function abiToWank()
{
  cAbi.SetTextProperty("fourVerb","wank");
  cAbi.SetTextProperty("moveVerb","dance");
  cPaul.SetTextProperty("fourVerb","fuck");
  cPaul.SetTextProperty("moveVerb","push");
}

function paulToWank()
{
   cAbi.SetTextProperty("fourVerb","fuck");
   cAbi.SetTextProperty("moveVerb","push");
  cPaul.SetTextProperty("fourVerb","wank");
  cPaul.SetTextProperty("moveVerb","dance");
}
function actuallyChangeCharacter()
{
     if(IsPlayerAbi){
      cPaul.SetAsPlayer();
      paulToWank();
      IsPlayerAbi = false;
    } else {
      cAbi.SetAsPlayer();
      abiToWank();
      IsPlayerAbi = true;
    }
}

function scrollingFlatExterior()
{
  //both in room 7 scrolling
    if(cPaul.Room == 7 && cAbi.Room == 7)
    {
      if(Find.findPlayer() != Find.findOtherPlayer())
      {        
        switch(Find.findPlayer())
        {
          case 1:          
            Game.Camera.TweenSize(1.0, 940, 522, eEaseInBackTween, eBlockTween);
            Game.Camera.AutoTracking = true;          
            Game.Camera.TweenSize(1.0, 360, 200, eEaseOutBackTween, eBlockTween); 
            Game.Camera.TweenPosition(1.0, 10, 322, eEaseInOutBackTween, eNoBlockTween);
            zoomedOut = false;
          break;
          case 2:          
            Game.Camera.TweenSize(1.0, 940, 522, eEaseInBackTween, eNoBlockTween);
            zoomedOut = true;          
          break;
          case 3:          
            Game.Camera.TweenSize(1.0, 940, 522, eEaseInBackTween, eBlockTween);
            Game.Camera.AutoTracking = true;          
            Game.Camera.TweenSize(1.0, 360, 200, eEaseOutBackTween, eBlockTween); 
            Game.Camera.TweenPosition(1.0, 546, 322, eEaseInOutBackTween, eNoBlockTween); 
            zoomedOut = false;
          break;
          case 4:
          Display("error");
          break;
        }
      }
      characterChange = false;
    }
}

function scrollingOmniCor1()
{
  if(cPaul.Room == 12 && cAbi.Room == 12 && Find.findPlayer() != Find.findOtherPlayer())
  {
    if(Find.findOtherPlayer() == 1)
    {
      Game.Camera.TweenX(1.0, 0, eEaseInOutSineTween, eNoBlockTween);
    } else {
      Game.Camera.TweenX(1.0, 250, eEaseInOutSineTween, eNoBlockTween);      
    }
  }
}

function scrollingOmniOffice()
{
  if(cPaul.Room == 13 && cAbi.Room == 13 && Find.findPlayer() != Find.findOtherPlayer())
  {
    if(Find.findOtherPlayer() == 1)
    {
      Game.Camera.TweenX(1.0, 306, eEaseInOutSineTween, eNoBlockTween);
    } else if (Find.findOtherPlayer() == 2)
    {
      Game.Camera.TweenX(1.0, 524, eEaseInOutSineTween, eNoBlockTween);
    } else if (Find.findOtherPlayer() == 3)
    {
       Game.Camera.TweenX(1.0, 707, eEaseInOutSineTween, eNoBlockTween);
    }    
  }
}

function scrollingOmniCor2()
{
  if(cPaul.Room == 14 && cAbi.Room == 14 && Find.findPlayer() != Find.findOtherPlayer())
  {
    if(Find.findOtherPlayer() == 1)
    {
      Game.Camera.TweenX(1.0, 224, eEaseInOutSineTween, eNoBlockTween); 
    } else {
      Game.Camera.TweenX(1.0, 478, eEaseInOutSineTween, eNoBlockTween);
    }
    
  }
}

function stopPhoneRinging()
{
  if(phoneRinging!=null)
  {
    if(phoneRinging.IsPlaying)
    {
      if(Find.findLocale() == 1 && Find.findOtherLocale() != 1)
      {
        phoneRinging.TweenFadeOut(0.2, eEaseInSineTween, eNoBlockTween);
        gAlert.Visible = false;
      }
    }
  }
}

function switchFromAlarm()
{  
  Character* otherChar;
  if(IsPlayerAbi)
  {
    otherChar = cPaul;
  } else {
    otherChar = cAbi;
  }
  
  if(otherChar.Room == 303)
  {
    //put otherChar in sleep mode, whatever that means
    otherChar.ChangeRoom(otherChar.PreviousRoom);
  }
}

function allowSkipping()
{
  allowSkipWalk = true;
}

function switchProtagonist()
{
  
  
  resetMouseMode();
  disableSwitchButton();
  stopFollowingOnSwitch();
  characterChange = true;
  tweeningfromTheHall();
  scrollingOmniCor1();
  scrollingOmniOffice();
  scrollingOmniCor2();
  
  stopPhoneRinging();
  
  actuallyChangeCharacter();
  
  scrollingFlatExterior();
  highlightNewPlayer();  
  switchFromAlarm();
  allowSkipping();
}
    